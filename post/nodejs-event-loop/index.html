<!DOCTYPE html><html  lang="zh-CN"><head><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>[译] 理解 Node.js 事件循环 | 文蔺的博客</title>
<style>*,::backdrop,:after,:before{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:#3b82f680;--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }*,:after,:before{border:0 solid #e5e7eb;box-sizing:border-box}:after,:before{--tw-content:""}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Noto Sans SC,PingFang SC,Hiragino Sans GB,Microsoft YaHei,sans-serif;font-feature-settings:normal;font-variation-settings:normal;tab-size:4;-webkit-tap-highlight-color:transparent}body{line-height:inherit;margin:0}hr{border-top-width:1px;color:inherit;height:0}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,SF Mono,Menlo,Consolas,Liberation Mono,monospace;font-feature-settings:normal;font-size:1em;font-variation-settings:normal}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:initial}sub{bottom:-.25em}sup{top:-.5em}table{border-collapse:collapse;border-color:inherit;text-indent:0}button,input,optgroup,select,textarea{color:inherit;font-family:inherit;font-feature-settings:inherit;font-size:100%;font-variation-settings:inherit;font-weight:inherit;letter-spacing:inherit;line-height:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:initial;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:initial}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0}fieldset,legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{color:#9ca3af;opacity:1}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{height:auto;max-width:100%}[hidden]:where(:not([hidden=until-found])){display:none}.container{width:100%}@media(min-width:640px){.container{max-width:640px}}@media(min-width:768px){.container{max-width:768px}}@media(min-width:1024px){.container{max-width:1024px}}@media(min-width:1280px){.container{max-width:1280px}}@media(min-width:1536px){.container{max-width:1536px}}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.inset-0{inset:0}.left-0{left:0}.right-0{right:0}.top-0{top:0}.z-40{z-index:40}.z-50{z-index:50}.z-\[9999\]{z-index:9999}.m-0{margin:0}.mx-auto{margin-left:auto;margin-right:auto}.mb-2{margin-bottom:.5rem}.mb-2\.5{margin-bottom:.625rem}.mb-4{margin-bottom:1rem}.mb-5{margin-bottom:1.25rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.mt-1{margin-top:.25rem}.mt-2{margin-top:.5rem}.mt-3{margin-top:.75rem}.mt-5{margin-top:1.25rem}.mt-6{margin-top:1.5rem}.mt-8{margin-top:2rem}.block{display:block}.inline-block{display:inline-block}.flex{display:flex}.inline-flex{display:inline-flex}.table{display:table}.grid{display:grid}.hidden{display:none}.h-16{height:4rem}.h-5{height:1.25rem}.h-8{height:2rem}.h-9{height:2.25rem}.h-\[18px\]{height:18px}.h-full{height:100%}.min-h-\[calc\(100vh-200px\)\]{min-height:calc(100vh - 200px)}.min-h-screen{min-height:100vh}.w-5{width:1.25rem}.w-8{width:2rem}.w-9{width:2.25rem}.w-\[18px\]{width:18px}.min-w-0{min-width:0}.max-w-\[45\%\]{max-width:45%}.max-w-\[450px\]{max-width:450px}.max-w-content{max-width:960px}.max-w-prose{max-width:720px}.flex-1{flex:1 1 0%}.shrink-0{flex-shrink:0}.transform{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.cursor-pointer{cursor:pointer}.resize{resize:both}.list-none{list-style-type:none}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.items-baseline{align-items:baseline}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-0\.5{gap:.125rem}.gap-1{gap:.25rem}.gap-1\.5{gap:.375rem}.gap-2\.5{gap:.625rem}.gap-3{gap:.75rem}.gap-4{gap:1rem}.gap-6{gap:1.5rem}.overflow-hidden,.truncate{overflow:hidden}.truncate{white-space:nowrap}.text-ellipsis,.truncate{text-overflow:ellipsis}.whitespace-nowrap{white-space:nowrap}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:.5rem}.rounded-md{border-radius:.375rem}.rounded-xl{border-radius:.75rem}.border{border-width:1px}.border-b{border-bottom-width:1px}.border-t{border-top-width:1px}.border-none{border-style:none}.border-slate-100{--tw-border-opacity:1;border-color:rgb(241 245 249/var(--tw-border-opacity,1))}.border-slate-200{--tw-border-opacity:1;border-color:rgb(226 232 240/var(--tw-border-opacity,1))}.\!bg-slate-50{--tw-bg-opacity:1!important;background-color:rgb(248 250 252/var(--tw-bg-opacity,1))!important}.bg-black\/40{background-color:#0006}.bg-blue-600{--tw-bg-opacity:1;background-color:rgb(37 99 235/var(--tw-bg-opacity,1))}.bg-slate-100{--tw-bg-opacity:1;background-color:rgb(241 245 249/var(--tw-bg-opacity,1))}.bg-slate-50{--tw-bg-opacity:1;background-color:rgb(248 250 252/var(--tw-bg-opacity,1))}.bg-transparent{background-color:initial}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity,1))}.bg-white\/90{background-color:#ffffffe6}.object-cover{object-fit:cover}.p-0{padding:0}.p-4{padding:1rem}.p-6{padding:1.5rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-1\.5{padding-bottom:.375rem;padding-top:.375rem}.py-10{padding-bottom:2.5rem;padding-top:2.5rem}.py-2{padding-bottom:.5rem;padding-top:.5rem}.py-2\.5{padding-bottom:.625rem;padding-top:.625rem}.py-4{padding-bottom:1rem;padding-top:1rem}.pb-10{padding-bottom:2.5rem}.pb-2{padding-bottom:.5rem}.pt-20{padding-top:5rem}.pt-8{padding-top:2rem}.text-center{text-align:center}.font-sans{font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Noto Sans SC,PingFang SC,Hiragino Sans GB,Microsoft YaHei,sans-serif}.text-2xl{font-size:1.5rem;line-height:2rem}.text-\[0\.9em\]{font-size:.9em}.text-\[13px\]{font-size:13px}.text-\[15px\]{font-size:15px}.text-\[17px\]{font-size:17px}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.font-normal{font-weight:400}.font-semibold{font-weight:600}.leading-relaxed{line-height:1.625}.leading-snug{line-height:1.375}.leading-tight{line-height:1.25}.tracking-tight{letter-spacing:-.025em}.\!text-blue-600{--tw-text-opacity:1!important;color:rgb(37 99 235/var(--tw-text-opacity,1))!important}.text-blue-600{--tw-text-opacity:1;color:rgb(37 99 235/var(--tw-text-opacity,1))}.text-slate-400{--tw-text-opacity:1;color:rgb(148 163 184/var(--tw-text-opacity,1))}.text-slate-600{--tw-text-opacity:1;color:rgb(71 85 105/var(--tw-text-opacity,1))}.text-slate-700{--tw-text-opacity:1;color:rgb(51 65 85/var(--tw-text-opacity,1))}.text-slate-900{--tw-text-opacity:1;color:rgb(15 23 42/var(--tw-text-opacity,1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity,1))}.no-underline{text-decoration-line:none}.opacity-50{opacity:.5}.opacity-70{opacity:.7}.shadow{--tw-shadow:0 1px 3px 0 #0000001a,0 1px 2px -1px #0000001a;--tw-shadow-colored:0 1px 3px 0 var(--tw-shadow-color),0 1px 2px -1px var(--tw-shadow-color)}.shadow,.shadow-sm{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-sm{--tw-shadow:0 1px 2px 0 #0000000d;--tw-shadow-colored:0 1px 2px 0 var(--tw-shadow-color)}.outline{outline-style:solid}.blur{--tw-blur:blur(8px)}.blur,.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.backdrop-blur-xl{--tw-backdrop-blur:blur(24px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.transition{transition-duration:.15s;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1)}.transition-all{transition-duration:.15s;transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1)}.transition-colors{transition-duration:.15s;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1)}.duration-300{transition-duration:.3s}.last\:border-b-0:last-child{border-bottom-width:0}.hover\:border-blue-200:hover{--tw-border-opacity:1;border-color:rgb(191 219 254/var(--tw-border-opacity,1))}.hover\:border-blue-600:hover{--tw-border-opacity:1;border-color:rgb(37 99 235/var(--tw-border-opacity,1))}.hover\:bg-blue-100:hover{--tw-bg-opacity:1;background-color:rgb(219 234 254/var(--tw-bg-opacity,1))}.hover\:bg-blue-700:hover{--tw-bg-opacity:1;background-color:rgb(29 78 216/var(--tw-bg-opacity,1))}.hover\:bg-slate-100:hover{--tw-bg-opacity:1;background-color:rgb(241 245 249/var(--tw-bg-opacity,1))}.hover\:text-blue-600:hover{--tw-text-opacity:1;color:rgb(37 99 235/var(--tw-text-opacity,1))}.hover\:text-blue-700:hover{--tw-text-opacity:1;color:rgb(29 78 216/var(--tw-text-opacity,1))}.hover\:text-blue-800:hover{--tw-text-opacity:1;color:rgb(30 64 175/var(--tw-text-opacity,1))}.hover\:text-slate-900:hover{--tw-text-opacity:1;color:rgb(15 23 42/var(--tw-text-opacity,1))}.hover\:shadow-md:hover{--tw-shadow:0 4px 6px -1px #0000001a,0 2px 4px -2px #0000001a;--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color),0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.focus-visible\:outline-2:focus-visible{outline-width:2px}.focus-visible\:outline-offset-2:focus-visible{outline-offset:2px}.focus-visible\:outline-blue-600:focus-visible{outline-color:#2563eb}@media not all and (min-width:768px){.max-md\:fixed{position:fixed}.max-md\:left-0{left:0}.max-md\:right-0{right:0}.max-md\:top-16{top:4rem}.max-md\:z-\[99\]{z-index:99}.max-md\:inline-flex{display:inline-flex}.max-md\:hidden{display:none}.max-md\:w-full{width:100%}.max-md\:max-w-full{max-width:100%}.max-md\:flex-col{flex-direction:column}.max-md\:justify-center{justify-content:center}.max-md\:gap-0\.5{gap:.125rem}.max-md\:gap-3{gap:.75rem}.max-md\:border-b{border-bottom-width:1px}.max-md\:border-slate-200{--tw-border-opacity:1;border-color:rgb(226 232 240/var(--tw-border-opacity,1))}.max-md\:bg-white\/\[0\.98\]{background-color:#fffffffa}.max-md\:p-4{padding:1rem}.max-md\:p-5{padding:1.25rem}.max-md\:px-3\.5{padding-left:.875rem;padding-right:.875rem}.max-md\:py-2\.5{padding-bottom:.625rem;padding-top:.625rem}.max-md\:text-\[15px\]{font-size:15px}.max-md\:shadow-lg{--tw-shadow:0 10px 15px -3px #0000001a,0 4px 6px -4px #0000001a;--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color),0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.max-md\:backdrop-blur-xl{--tw-backdrop-blur:blur(24px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}}@media(min-width:768px){.md\:text-3xl{font-size:1.875rem;line-height:2.25rem}}.dark\:border-slate-700:where([data-theme=dark],[data-theme=dark] *){--tw-border-opacity:1;border-color:rgb(51 65 85/var(--tw-border-opacity,1))}.dark\:border-slate-800:where([data-theme=dark],[data-theme=dark] *){--tw-border-opacity:1;border-color:rgb(30 41 59/var(--tw-border-opacity,1))}.dark\:\!bg-slate-800:where([data-theme=dark],[data-theme=dark] *){--tw-bg-opacity:1!important;background-color:rgb(30 41 59/var(--tw-bg-opacity,1))!important}.dark\:bg-blue-500:where([data-theme=dark],[data-theme=dark] *){--tw-bg-opacity:1;background-color:rgb(59 130 246/var(--tw-bg-opacity,1))}.dark\:bg-slate-800:where([data-theme=dark],[data-theme=dark] *){--tw-bg-opacity:1;background-color:rgb(30 41 59/var(--tw-bg-opacity,1))}.dark\:bg-slate-800\/50:where([data-theme=dark],[data-theme=dark] *){background-color:#1e293b80}.dark\:bg-slate-900:where([data-theme=dark],[data-theme=dark] *){--tw-bg-opacity:1;background-color:rgb(15 23 42/var(--tw-bg-opacity,1))}.dark\:bg-slate-900\/90:where([data-theme=dark],[data-theme=dark] *){background-color:#0f172ae6}.dark\:\!text-blue-400:where([data-theme=dark],[data-theme=dark] *){--tw-text-opacity:1!important;color:rgb(96 165 250/var(--tw-text-opacity,1))!important}.dark\:text-blue-400:where([data-theme=dark],[data-theme=dark] *){--tw-text-opacity:1;color:rgb(96 165 250/var(--tw-text-opacity,1))}.dark\:text-slate-100:where([data-theme=dark],[data-theme=dark] *){--tw-text-opacity:1;color:rgb(241 245 249/var(--tw-text-opacity,1))}.dark\:text-slate-300:where([data-theme=dark],[data-theme=dark] *){--tw-text-opacity:1;color:rgb(203 213 225/var(--tw-text-opacity,1))}.dark\:text-slate-600:where([data-theme=dark],[data-theme=dark] *){--tw-text-opacity:1;color:rgb(71 85 105/var(--tw-text-opacity,1))}.dark\:hover\:border-blue-400:hover:where([data-theme=dark],[data-theme=dark] *){--tw-border-opacity:1;border-color:rgb(96 165 250/var(--tw-border-opacity,1))}.dark\:hover\:border-blue-800:hover:where([data-theme=dark],[data-theme=dark] *){--tw-border-opacity:1;border-color:rgb(30 64 175/var(--tw-border-opacity,1))}.dark\:hover\:bg-blue-600:hover:where([data-theme=dark],[data-theme=dark] *){--tw-bg-opacity:1;background-color:rgb(37 99 235/var(--tw-bg-opacity,1))}.dark\:hover\:bg-blue-900\/50:hover:where([data-theme=dark],[data-theme=dark] *){background-color:#1e3a8a80}.dark\:hover\:bg-slate-800:hover:where([data-theme=dark],[data-theme=dark] *){--tw-bg-opacity:1;background-color:rgb(30 41 59/var(--tw-bg-opacity,1))}.dark\:hover\:text-blue-300:hover:where([data-theme=dark],[data-theme=dark] *){--tw-text-opacity:1;color:rgb(147 197 253/var(--tw-text-opacity,1))}.dark\:hover\:text-blue-400:hover:where([data-theme=dark],[data-theme=dark] *){--tw-text-opacity:1;color:rgb(96 165 250/var(--tw-text-opacity,1))}.dark\:hover\:text-slate-100:hover:where([data-theme=dark],[data-theme=dark] *){--tw-text-opacity:1;color:rgb(241 245 249/var(--tw-text-opacity,1))}@media not all and (min-width:768px){.max-md\:dark\:border-slate-700:where([data-theme=dark],[data-theme=dark] *){--tw-border-opacity:1;border-color:rgb(51 65 85/var(--tw-border-opacity,1))}.max-md\:dark\:bg-slate-900\/\[0\.98\]:where([data-theme=dark],[data-theme=dark] *){background-color:#0f172afa}}.\[\&\>p\]\:m-0>p{margin:0}</style>
<style>*,:after,:before{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }*,:after,:before{border:0 solid #e5e7eb;box-sizing:border-box}:after,:before{--tw-content:""}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Noto Sans SC,PingFang SC,Hiragino Sans GB,Microsoft YaHei,sans-serif;font-feature-settings:normal;font-variation-settings:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-tap-highlight-color:transparent}body{line-height:inherit;margin:0}hr{border-top-width:1px;color:inherit;height:0}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,SF Mono,Menlo,Consolas,Liberation Mono,monospace;font-feature-settings:normal;font-size:1em;font-variation-settings:normal}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{border-collapse:collapse;border-color:inherit;text-indent:0}button,input,optgroup,select,textarea{color:inherit;font-family:inherit;font-feature-settings:inherit;font-size:100%;font-variation-settings:inherit;font-weight:inherit;letter-spacing:inherit;line-height:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0}fieldset,legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:#9ca3af;opacity:1}input::placeholder,textarea::placeholder{color:#9ca3af;opacity:1}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{height:auto;max-width:100%}[hidden]:where(:not([hidden=until-found])){display:none}html{scroll-behavior:smooth;scroll-padding-top:5rem}body{background-color:rgb(255 255 255/var(--tw-bg-opacity,1));color:rgb(71 85 105/var(--tw-text-opacity,1));font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Noto Sans SC,PingFang SC,Hiragino Sans GB,Microsoft YaHei,sans-serif;-webkit-font-smoothing:subpixel-antialiased;-webkit-tap-highlight-color:transparent;transition:background-color .3s ease,color .3s ease}[data-theme=dark] body,body{--tw-bg-opacity:1;--tw-text-opacity:1}[data-theme=dark] body{background-color:rgb(15 23 42/var(--tw-bg-opacity,1));color:rgb(203 213 225/var(--tw-text-opacity,1))}:focus-visible{outline-color:#2563eb;outline-offset:2px;outline-width:2px}[data-theme=dark] :focus-visible{outline-color:#60a5fa}:focus:not(:focus-visible){outline:none}@media(prefers-reduced-motion:reduce){*,:after,:before{animation-duration:.01ms!important;animation-iteration-count:1!important;scroll-behavior:auto!important;transition-duration:.01ms!important}}.container{width:100%}@media(min-width:640px){.container{max-width:640px}}@media(min-width:768px){.container{max-width:768px}}@media(min-width:1024px){.container{max-width:1024px}}@media(min-width:1280px){.container{max-width:1280px}}@media(min-width:1536px){.container{max-width:1536px}}.skip-link{border-radius:.375rem;left:1rem;position:absolute;top:-100%;z-index:10000;--tw-bg-opacity:1;background-color:rgb(37 99 235/var(--tw-bg-opacity,1));font-size:.875rem;font-weight:500;line-height:1.25rem;padding:.5rem 1rem;text-decoration-line:none;transition:top .2s ease}.skip-link,.skip-link:focus{--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity,1))}.skip-link:focus{top:1rem}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.inset-0{inset:0}.left-0{left:0}.right-0{right:0}.top-0{top:0}.z-40{z-index:40}.z-50{z-index:50}.z-\[9999\]{z-index:9999}.m-0{margin:0}.mx-auto{margin-left:auto;margin-right:auto}.mb-2{margin-bottom:.5rem}.mb-2\.5{margin-bottom:.625rem}.mb-4{margin-bottom:1rem}.mb-5{margin-bottom:1.25rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.mt-1{margin-top:.25rem}.mt-2{margin-top:.5rem}.mt-3{margin-top:.75rem}.mt-5{margin-top:1.25rem}.mt-6{margin-top:1.5rem}.mt-8{margin-top:2rem}.block{display:block}.inline-block{display:inline-block}.flex{display:flex}.inline-flex{display:inline-flex}.table{display:table}.grid{display:grid}.hidden{display:none}.h-16{height:4rem}.h-5{height:1.25rem}.h-8{height:2rem}.h-9{height:2.25rem}.h-\[18px\]{height:18px}.h-full{height:100%}.min-h-\[calc\(100vh-200px\)\]{min-height:calc(100vh - 200px)}.min-h-screen{min-height:100vh}.w-5{width:1.25rem}.w-8{width:2rem}.w-9{width:2.25rem}.w-\[18px\]{width:18px}.min-w-0{min-width:0}.max-w-\[45\%\]{max-width:45%}.max-w-\[450px\]{max-width:450px}.max-w-content{max-width:960px}.max-w-prose{max-width:720px}.flex-1{flex:1 1 0%}.shrink-0{flex-shrink:0}.transform{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.cursor-pointer{cursor:pointer}.resize{resize:both}.list-none{list-style-type:none}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.items-baseline{align-items:baseline}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-0\.5{gap:.125rem}.gap-1{gap:.25rem}.gap-1\.5{gap:.375rem}.gap-2\.5{gap:.625rem}.gap-3{gap:.75rem}.gap-4{gap:1rem}.gap-6{gap:1.5rem}.overflow-hidden,.truncate{overflow:hidden}.truncate{white-space:nowrap}.text-ellipsis,.truncate{text-overflow:ellipsis}.whitespace-nowrap{white-space:nowrap}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:.5rem}.rounded-md{border-radius:.375rem}.rounded-xl{border-radius:.75rem}.border{border-width:1px}.border-b{border-bottom-width:1px}.border-t{border-top-width:1px}.border-none{border-style:none}.border-slate-100{--tw-border-opacity:1;border-color:rgb(241 245 249/var(--tw-border-opacity,1))}.border-slate-200{--tw-border-opacity:1;border-color:rgb(226 232 240/var(--tw-border-opacity,1))}.\!bg-slate-50{--tw-bg-opacity:1!important;background-color:rgb(248 250 252/var(--tw-bg-opacity,1))!important}.bg-black\/40{background-color:#0006}.bg-blue-600{--tw-bg-opacity:1;background-color:rgb(37 99 235/var(--tw-bg-opacity,1))}.bg-slate-100{--tw-bg-opacity:1;background-color:rgb(241 245 249/var(--tw-bg-opacity,1))}.bg-slate-50{--tw-bg-opacity:1;background-color:rgb(248 250 252/var(--tw-bg-opacity,1))}.bg-transparent{background-color:transparent}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity,1))}.bg-white\/90{background-color:#ffffffe6}.object-cover{-o-object-fit:cover;object-fit:cover}.p-0{padding:0}.p-4{padding:1rem}.p-6{padding:1.5rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-1\.5{padding-bottom:.375rem;padding-top:.375rem}.py-10{padding-bottom:2.5rem;padding-top:2.5rem}.py-2{padding-bottom:.5rem;padding-top:.5rem}.py-2\.5{padding-bottom:.625rem;padding-top:.625rem}.py-4{padding-bottom:1rem;padding-top:1rem}.pb-10{padding-bottom:2.5rem}.pb-2{padding-bottom:.5rem}.pt-20{padding-top:5rem}.pt-8{padding-top:2rem}.text-center{text-align:center}.font-sans{font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Noto Sans SC,PingFang SC,Hiragino Sans GB,Microsoft YaHei,sans-serif}.text-2xl{font-size:1.5rem;line-height:2rem}.text-\[0\.9em\]{font-size:.9em}.text-\[13px\]{font-size:13px}.text-\[15px\]{font-size:15px}.text-\[17px\]{font-size:17px}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.font-normal{font-weight:400}.font-semibold{font-weight:600}.leading-relaxed{line-height:1.625}.leading-snug{line-height:1.375}.leading-tight{line-height:1.25}.tracking-tight{letter-spacing:-.025em}.\!text-blue-600{--tw-text-opacity:1!important;color:rgb(37 99 235/var(--tw-text-opacity,1))!important}.text-blue-600{--tw-text-opacity:1;color:rgb(37 99 235/var(--tw-text-opacity,1))}.text-slate-400{--tw-text-opacity:1;color:rgb(148 163 184/var(--tw-text-opacity,1))}.text-slate-600{--tw-text-opacity:1;color:rgb(71 85 105/var(--tw-text-opacity,1))}.text-slate-700{--tw-text-opacity:1;color:rgb(51 65 85/var(--tw-text-opacity,1))}.text-slate-900{--tw-text-opacity:1;color:rgb(15 23 42/var(--tw-text-opacity,1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity,1))}.no-underline{text-decoration-line:none}.opacity-50{opacity:.5}.opacity-70{opacity:.7}.shadow{--tw-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px -1px rgba(0,0,0,.1);--tw-shadow-colored:0 1px 3px 0 var(--tw-shadow-color),0 1px 2px -1px var(--tw-shadow-color)}.shadow,.shadow-sm{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-sm{--tw-shadow:0 1px 2px 0 rgba(0,0,0,.05);--tw-shadow-colored:0 1px 2px 0 var(--tw-shadow-color)}.outline{outline-style:solid}.blur{--tw-blur:blur(8px)}.blur,.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.backdrop-blur-xl{--tw-backdrop-blur:blur(24px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.transition{transition-duration:.15s;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1)}.transition-all{transition-duration:.15s;transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1)}.transition-colors{transition-duration:.15s;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1)}.duration-300{transition-duration:.3s}.entry-content{font-size:1rem;line-height:1.5rem;line-height:1.625}.entry-content blockquote,.entry-content dl,.entry-content h1,.entry-content h2,.entry-content h3,.entry-content h4,.entry-content h5,.entry-content h6,.entry-content iframe,.entry-content ol,.entry-content p,.entry-content pre,.entry-content table,.entry-content ul{margin-top:1rem}.entry-content h2{border-bottom-width:1px;margin-top:2rem;--tw-border-opacity:1;border-color:rgb(241 245 249/var(--tw-border-opacity,1));font-size:1.25rem;font-weight:700;line-height:1.75rem;padding-bottom:.5rem;--tw-text-opacity:1;color:rgb(15 23 42/var(--tw-text-opacity,1))}[data-theme=dark] .entry-content h2{--tw-border-opacity:1;border-color:rgb(30 41 59/var(--tw-border-opacity,1));--tw-text-opacity:1;color:rgb(241 245 249/var(--tw-text-opacity,1))}.entry-content h3{font-size:1.125rem;font-weight:600;line-height:1.75rem;margin-top:1.5rem;--tw-text-opacity:1;color:rgb(15 23 42/var(--tw-text-opacity,1))}[data-theme=dark] .entry-content h3{--tw-text-opacity:1;color:rgb(241 245 249/var(--tw-text-opacity,1))}.entry-content h4{font-size:1rem;font-weight:600;line-height:1.5rem;margin-top:1.25rem;--tw-text-opacity:1;color:rgb(15 23 42/var(--tw-text-opacity,1))}[data-theme=dark] .entry-content h4{--tw-text-opacity:1;color:rgb(241 245 249/var(--tw-text-opacity,1))}.entry-content dl,.entry-content ol,.entry-content ul{margin-left:1.5rem}.entry-content blockquote>p:first-of-type,.entry-content dl ol,.entry-content dl ul,.entry-content ol ol,.entry-content ol ul,.entry-content ul ol,.entry-content ul ul{margin-top:0}.entry-content a{--tw-text-opacity:1;color:rgb(37 99 235/var(--tw-text-opacity,1))}.entry-content a:hover{--tw-text-opacity:1;color:rgb(30 64 175/var(--tw-text-opacity,1))}[data-theme=dark] .entry-content a{--tw-text-opacity:1;color:rgb(96 165 250/var(--tw-text-opacity,1))}[data-theme=dark] .entry-content a:hover{--tw-text-opacity:1;color:rgb(147 197 253/var(--tw-text-opacity,1))}.entry-content blockquote{border-bottom-right-radius:.375rem;border-left-width:4px;border-top-right-radius:.375rem;margin-bottom:1rem;margin-top:1rem;--tw-border-opacity:1;border-color:rgb(37 99 235/var(--tw-border-opacity,1));--tw-bg-opacity:1;background-color:rgb(248 250 252/var(--tw-bg-opacity,1));padding:1rem 1.25rem}[data-theme=dark] .entry-content blockquote{--tw-border-opacity:1;border-color:rgb(96 165 250/var(--tw-border-opacity,1));--tw-bg-opacity:1;background-color:rgb(30 41 59/var(--tw-bg-opacity,1))}.entry-content blockquote p{margin-bottom:0}.entry-content blockquote a{word-break:break-all}.entry-content code{border-radius:.25rem;margin-left:.125rem;margin-right:.125rem;--tw-bg-opacity:1;background-color:rgb(241 245 249/var(--tw-bg-opacity,1));font-family:ui-monospace,SFMono-Regular,SF Mono,Menlo,Consolas,Liberation Mono,monospace;font-size:.875em;padding:.125rem .375rem;vertical-align:middle;--tw-text-opacity:1;color:rgb(30 41 59/var(--tw-text-opacity,1))}[data-theme=dark] .entry-content code{--tw-bg-opacity:1;background-color:rgb(30 41 59/var(--tw-bg-opacity,1));--tw-text-opacity:1;color:rgb(226 232 240/var(--tw-text-opacity,1))}.entry-content pre{border-radius:.5rem;border-width:1px;overflow:hidden;position:relative;white-space:pre-wrap;word-break:break-all;--tw-border-opacity:1;border-color:rgb(226 232 240/var(--tw-border-opacity,1));--tw-bg-opacity:1;background-color:rgb(248 250 252/var(--tw-bg-opacity,1));font-family:ui-monospace,SFMono-Regular,SF Mono,Menlo,Consolas,Liberation Mono,monospace;font-size:.875rem;line-height:1.25rem;line-height:1.625;padding:1rem}[data-theme=dark] .entry-content pre{--tw-border-opacity:1;border-color:rgb(51 65 85/var(--tw-border-opacity,1));--tw-bg-opacity:1;background-color:rgb(30 41 59/var(--tw-bg-opacity,1));--tw-text-opacity:1;color:rgb(226 232 240/var(--tw-text-opacity,1))}.entry-content pre code{background-color:transparent;border-radius:0;border-width:0;display:block;font-size:100%;margin:0;padding:0;position:relative}.entry-content pre b.name{font-size:3rem;line-height:1;pointer-events:none;position:absolute;right:.625rem;top:.625rem;--tw-text-opacity:1;color:rgb(241 245 249/var(--tw-text-opacity,1))}[data-theme=dark] .entry-content pre b.name{--tw-text-opacity:1;color:rgb(51 65 85/var(--tw-text-opacity,1))}.entry-content img{border-radius:.375rem;border-width:1px;display:block;margin-bottom:1rem;margin-top:1rem;max-width:100%;--tw-border-opacity:1;border-color:rgb(226 232 240/var(--tw-border-opacity,1));padding:0}[data-theme=dark] .entry-content img{--tw-border-opacity:1;border-color:rgb(51 65 85/var(--tw-border-opacity,1))}.entry-content table{border-collapse:collapse;display:block;overflow-x:auto;width:100%}.entry-content table th{border-bottom-width:2px;--tw-border-opacity:1;border-color:rgb(148 163 184/var(--tw-border-opacity,1));font-weight:600;padding:.5rem 1rem;text-align:left}[data-theme=dark] .entry-content table th{--tw-border-opacity:1;border-color:rgb(71 85 105/var(--tw-border-opacity,1))}.entry-content table td{border-bottom-width:1px;--tw-border-opacity:1;border-color:rgb(226 232 240/var(--tw-border-opacity,1));padding:.5rem 1rem}[data-theme=dark] .entry-content table td{--tw-border-opacity:1;border-color:rgb(51 65 85/var(--tw-border-opacity,1))}.entry-content .date{font-size:.875rem;font-style:italic;line-height:1.25rem;--tw-text-opacity:1;color:rgb(71 85 105/var(--tw-text-opacity,1))}[data-theme=dark] .entry-content .date{--tw-text-opacity:1;color:rgb(203 213 225/var(--tw-text-opacity,1))}.entry-content .expire-tips{border-bottom-right-radius:.375rem;border-color:rgb(253 230 138/var(--tw-border-opacity,1));border-top-right-radius:.375rem;border-width:1px 1px 1px 4px;--tw-border-opacity:1;border-left-color:rgb(245 158 11/var(--tw-border-opacity,1));--tw-bg-opacity:1;background-color:rgb(255 251 235/var(--tw-bg-opacity,1));font-size:15px;padding:.75rem;--tw-text-opacity:1;color:rgb(15 23 42/var(--tw-text-opacity,1))}[data-theme=dark] .entry-content .expire-tips{border-color:rgb(180 83 9/var(--tw-border-opacity,1));--tw-border-opacity:1;border-left-color:rgb(245 158 11/var(--tw-border-opacity,1));--tw-bg-opacity:1;background-color:rgb(69 26 3/var(--tw-bg-opacity,1));--tw-text-opacity:1;color:rgb(241 245 249/var(--tw-text-opacity,1))}.entry-content .aliyun-tips{border-bottom-right-radius:.375rem;border-color:rgb(187 247 208/var(--tw-border-opacity,1));border-top-right-radius:.375rem;border-width:1px 1px 1px 4px;--tw-border-opacity:1;border-left-color:rgb(34 197 94/var(--tw-border-opacity,1));--tw-bg-opacity:1;background-color:rgb(240 253 244/var(--tw-bg-opacity,1));font-size:15px;padding:.75rem}[data-theme=dark] .entry-content .aliyun-tips{border-color:rgb(21 128 61/var(--tw-border-opacity,1));--tw-border-opacity:1;border-left-color:rgb(34 197 94/var(--tw-border-opacity,1));--tw-bg-opacity:1;background-color:rgb(5 46 22/var(--tw-bg-opacity,1))}.entry-content .firekylin-code>ul{list-style-type:decimal;margin:0 0 0 2.5rem;--tw-bg-opacity:1;background-color:rgb(248 250 252/var(--tw-bg-opacity,1));padding:0}[data-theme=dark] .entry-content .firekylin-code>ul{--tw-bg-opacity:1;background-color:rgb(30 41 59/var(--tw-bg-opacity,1))}.entry-content .firekylin-code li{border-left-width:1px;list-style:decimal-leading-zero;position:relative;--tw-border-opacity:1;border-color:rgb(226 232 240/var(--tw-border-opacity,1));padding-left:.125rem}[data-theme=dark] .entry-content .firekylin-code li{--tw-border-opacity:1;border-color:rgb(51 65 85/var(--tw-border-opacity,1))}.entry-content .firekylin-code li.mark{--tw-bg-opacity:1!important;background-color:rgb(254 243 199/var(--tw-bg-opacity,1))!important}[data-theme=dark] .entry-content .firekylin-code li.mark{--tw-bg-opacity:1!important;background-color:rgb(69 26 3/var(--tw-bg-opacity,1))!important}.entry-content .firekylin-code li:hover{--tw-bg-opacity:1!important;background-color:rgb(226 232 240/var(--tw-bg-opacity,1))!important}[data-theme=dark] .entry-content .firekylin-code li:hover{--tw-bg-opacity:1!important;background-color:rgb(51 65 85/var(--tw-bg-opacity,1))!important}.entry-content .firekylin-code .line-num{cursor:pointer;height:100%;left:-40px;position:absolute;top:0;width:2.5rem}.entry-content .firekylin-code li:nth-of-type(2n){--tw-bg-opacity:1;background-color:rgb(241 245 249/var(--tw-bg-opacity,1));color:inherit}[data-theme=dark] .entry-content .firekylin-code li:nth-of-type(2n){background-color:#1e293b80}.entry-content pre .firekylin-code{--tw-bg-opacity:1;background-color:rgb(241 245 249/var(--tw-bg-opacity,1))}[data-theme=dark] .entry-content pre .firekylin-code{--tw-bg-opacity:1;background-color:rgb(30 41 59/var(--tw-bg-opacity,1))}a.anchor{display:block;position:relative;top:-80px;visibility:hidden}textarea.codespan,textarea.pre-area{display:none}.hljs{background-color:rgb(248 250 252/var(--tw-bg-opacity,1));color:rgb(30 41 59/var(--tw-text-opacity,1));display:block;overflow-x:auto;padding:.5rem;-webkit-text-size-adjust:none}.hljs,[data-theme=dark] .hljs{--tw-bg-opacity:1;--tw-text-opacity:1}[data-theme=dark] .hljs{background-color:rgb(30 41 59/var(--tw-bg-opacity,1));color:rgb(226 232 240/var(--tw-text-opacity,1))}.hljs-comment,.lang-bash .hljs-shebang,.lang-java .hljs-javadoc,.lang-javascript .hljs-javadoc,.lang-rust .hljs-preprocessor{--tw-text-opacity:1;color:rgb(148 163 184/var(--tw-text-opacity,1))}[data-theme=dark] .hljs-comment,[data-theme=dark] .lang-bash .hljs-shebang,[data-theme=dark] .lang-java .hljs-javadoc,[data-theme=dark] .lang-javascript .hljs-javadoc,[data-theme=dark] .lang-rust .hljs-preprocessor{--tw-text-opacity:1;color:rgb(100 116 139/var(--tw-text-opacity,1))}.hljs-string,.lang-json .hljs-attribute,.lang-markdown .hljs-value,.lang-xml .hljs-value{color:#059669}[data-theme=dark] .hljs-string,[data-theme=dark] .lang-json .hljs-attribute,[data-theme=dark] .lang-markdown .hljs-value,[data-theme=dark] .lang-xml .hljs-value{color:#86efac}.hljs-keyword,.lang-css .hljs-at_rule,.lang-css .hljs-important,.lang-http .hljs-request{color:#7c3aed}[data-theme=dark] .hljs-keyword,[data-theme=dark] .lang-css .hljs-at_rule,[data-theme=dark] .lang-css .hljs-important,[data-theme=dark] .lang-http .hljs-request{color:#c4b5fd}.hljs-built_in,.hljs-literal,.hljs-number,.lang-css .hljs-function,.lang-css .hljs-hexcolor,.lang-css .hljs-number{color:#2563eb}[data-theme=dark] .hljs-built_in,[data-theme=dark] .hljs-literal,[data-theme=dark] .hljs-number,[data-theme=dark] .lang-css .hljs-function,[data-theme=dark] .lang-css .hljs-hexcolor,[data-theme=dark] .lang-css .hljs-number{color:#93c5fd}.hljs-tag,.lang-css .hljs-tag,.lang-xml .hljs-title{color:#059669}[data-theme=dark] .hljs-tag,[data-theme=dark] .lang-css .hljs-tag,[data-theme=dark] .lang-xml .hljs-title{color:#86efac}.hljs-class,.hljs-id,.hljs-title,.lang-css .hljs-class,.lang-css .hljs-id,.lang-css .hljs-pseudo{color:#7c3aed}[data-theme=dark] .hljs-class,[data-theme=dark] .hljs-id,[data-theme=dark] .hljs-title,[data-theme=dark] .lang-css .hljs-class,[data-theme=dark] .lang-css .hljs-id,[data-theme=dark] .lang-css .hljs-pseudo{color:#c4b5fd}.hljs-variable,.lang-bash .hljs-variable,.lang-xml .hljs-tag{--tw-text-opacity:1;color:rgb(30 41 59/var(--tw-text-opacity,1))}[data-theme=dark] .hljs-variable,[data-theme=dark] .lang-bash .hljs-variable,[data-theme=dark] .lang-xml .hljs-tag{--tw-text-opacity:1;color:rgb(226 232 240/var(--tw-text-opacity,1))}.lang-diff .hljs-chunk{font-weight:700}.lang-diff .hljs-addition{color:#16a34a;--tw-bg-opacity:1;background-color:rgb(220 252 231/var(--tw-bg-opacity,1))}[data-theme=dark] .lang-diff .hljs-addition{color:#86efac;--tw-bg-opacity:1;background-color:rgb(5 46 22/var(--tw-bg-opacity,1))}.lang-diff .hljs-deletion{color:#dc2626;--tw-bg-opacity:1;background-color:rgb(254 226 226/var(--tw-bg-opacity,1))}[data-theme=dark] .lang-diff .hljs-deletion{color:#fca5a5;--tw-bg-opacity:1;background-color:rgb(69 10 10/var(--tw-bg-opacity,1))}.lang-markdown .hljs-link_url{text-decoration-line:underline}@media screen and (max-width:768px){.entry-content pre b.name{font-size:1.875rem;line-height:2.25rem}}.last\:border-b-0:last-child{border-bottom-width:0}.hover\:border-blue-200:hover{--tw-border-opacity:1;border-color:rgb(191 219 254/var(--tw-border-opacity,1))}.hover\:border-blue-600:hover{--tw-border-opacity:1;border-color:rgb(37 99 235/var(--tw-border-opacity,1))}.hover\:bg-blue-100:hover{--tw-bg-opacity:1;background-color:rgb(219 234 254/var(--tw-bg-opacity,1))}.hover\:bg-blue-700:hover{--tw-bg-opacity:1;background-color:rgb(29 78 216/var(--tw-bg-opacity,1))}.hover\:bg-slate-100:hover{--tw-bg-opacity:1;background-color:rgb(241 245 249/var(--tw-bg-opacity,1))}.hover\:text-blue-600:hover{--tw-text-opacity:1;color:rgb(37 99 235/var(--tw-text-opacity,1))}.hover\:text-blue-700:hover{--tw-text-opacity:1;color:rgb(29 78 216/var(--tw-text-opacity,1))}.hover\:text-blue-800:hover{--tw-text-opacity:1;color:rgb(30 64 175/var(--tw-text-opacity,1))}.hover\:text-slate-900:hover{--tw-text-opacity:1;color:rgb(15 23 42/var(--tw-text-opacity,1))}.hover\:shadow-md:hover{--tw-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -2px rgba(0,0,0,.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color),0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.focus-visible\:outline-2:focus-visible{outline-width:2px}.focus-visible\:outline-offset-2:focus-visible{outline-offset:2px}.focus-visible\:outline-blue-600:focus-visible{outline-color:#2563eb}@media not all and (min-width:768px){.max-md\:fixed{position:fixed}.max-md\:left-0{left:0}.max-md\:right-0{right:0}.max-md\:top-16{top:4rem}.max-md\:z-\[99\]{z-index:99}.max-md\:inline-flex{display:inline-flex}.max-md\:hidden{display:none}.max-md\:w-full{width:100%}.max-md\:max-w-full{max-width:100%}.max-md\:flex-col{flex-direction:column}.max-md\:justify-center{justify-content:center}.max-md\:gap-0\.5{gap:.125rem}.max-md\:gap-3{gap:.75rem}.max-md\:border-b{border-bottom-width:1px}.max-md\:border-slate-200{--tw-border-opacity:1;border-color:rgb(226 232 240/var(--tw-border-opacity,1))}.max-md\:bg-white\/\[0\.98\]{background-color:#fffffffa}.max-md\:p-4{padding:1rem}.max-md\:p-5{padding:1.25rem}.max-md\:px-3\.5{padding-left:.875rem;padding-right:.875rem}.max-md\:py-2\.5{padding-bottom:.625rem;padding-top:.625rem}.max-md\:text-\[15px\]{font-size:15px}.max-md\:shadow-lg{--tw-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -4px rgba(0,0,0,.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color),0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.max-md\:backdrop-blur-xl{--tw-backdrop-blur:blur(24px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}}@media(min-width:768px){.md\:text-3xl{font-size:1.875rem;line-height:2.25rem}}.dark\:border-slate-700:where([data-theme=dark],[data-theme=dark] *){--tw-border-opacity:1;border-color:rgb(51 65 85/var(--tw-border-opacity,1))}.dark\:border-slate-800:where([data-theme=dark],[data-theme=dark] *){--tw-border-opacity:1;border-color:rgb(30 41 59/var(--tw-border-opacity,1))}.dark\:\!bg-slate-800:where([data-theme=dark],[data-theme=dark] *){--tw-bg-opacity:1!important;background-color:rgb(30 41 59/var(--tw-bg-opacity,1))!important}.dark\:bg-blue-500:where([data-theme=dark],[data-theme=dark] *){--tw-bg-opacity:1;background-color:rgb(59 130 246/var(--tw-bg-opacity,1))}.dark\:bg-slate-800:where([data-theme=dark],[data-theme=dark] *){--tw-bg-opacity:1;background-color:rgb(30 41 59/var(--tw-bg-opacity,1))}.dark\:bg-slate-800\/50:where([data-theme=dark],[data-theme=dark] *){background-color:#1e293b80}.dark\:bg-slate-900:where([data-theme=dark],[data-theme=dark] *){--tw-bg-opacity:1;background-color:rgb(15 23 42/var(--tw-bg-opacity,1))}.dark\:bg-slate-900\/90:where([data-theme=dark],[data-theme=dark] *){background-color:#0f172ae6}.dark\:\!text-blue-400:where([data-theme=dark],[data-theme=dark] *){--tw-text-opacity:1!important;color:rgb(96 165 250/var(--tw-text-opacity,1))!important}.dark\:text-blue-400:where([data-theme=dark],[data-theme=dark] *){--tw-text-opacity:1;color:rgb(96 165 250/var(--tw-text-opacity,1))}.dark\:text-slate-100:where([data-theme=dark],[data-theme=dark] *){--tw-text-opacity:1;color:rgb(241 245 249/var(--tw-text-opacity,1))}.dark\:text-slate-300:where([data-theme=dark],[data-theme=dark] *){--tw-text-opacity:1;color:rgb(203 213 225/var(--tw-text-opacity,1))}.dark\:text-slate-600:where([data-theme=dark],[data-theme=dark] *){--tw-text-opacity:1;color:rgb(71 85 105/var(--tw-text-opacity,1))}.dark\:hover\:border-blue-400:hover:where([data-theme=dark],[data-theme=dark] *){--tw-border-opacity:1;border-color:rgb(96 165 250/var(--tw-border-opacity,1))}.dark\:hover\:border-blue-800:hover:where([data-theme=dark],[data-theme=dark] *){--tw-border-opacity:1;border-color:rgb(30 64 175/var(--tw-border-opacity,1))}.dark\:hover\:bg-blue-600:hover:where([data-theme=dark],[data-theme=dark] *){--tw-bg-opacity:1;background-color:rgb(37 99 235/var(--tw-bg-opacity,1))}.dark\:hover\:bg-blue-900\/50:hover:where([data-theme=dark],[data-theme=dark] *){background-color:#1e3a8a80}.dark\:hover\:bg-slate-800:hover:where([data-theme=dark],[data-theme=dark] *){--tw-bg-opacity:1;background-color:rgb(30 41 59/var(--tw-bg-opacity,1))}.dark\:hover\:text-blue-300:hover:where([data-theme=dark],[data-theme=dark] *){--tw-text-opacity:1;color:rgb(147 197 253/var(--tw-text-opacity,1))}.dark\:hover\:text-blue-400:hover:where([data-theme=dark],[data-theme=dark] *){--tw-text-opacity:1;color:rgb(96 165 250/var(--tw-text-opacity,1))}.dark\:hover\:text-slate-100:hover:where([data-theme=dark],[data-theme=dark] *){--tw-text-opacity:1;color:rgb(241 245 249/var(--tw-text-opacity,1))}@media not all and (min-width:768px){.max-md\:dark\:border-slate-700:where([data-theme=dark],[data-theme=dark] *){--tw-border-opacity:1;border-color:rgb(51 65 85/var(--tw-border-opacity,1))}.max-md\:dark\:bg-slate-900\/\[0\.98\]:where([data-theme=dark],[data-theme=dark] *){background-color:#0f172afa}}.\[\&\>p\]\:m-0>p{margin:0}</style>
<link rel="stylesheet" href="/_nuxt/style.BaioyBKr.css" crossorigin>
<link rel="preload" as="fetch" crossorigin="anonymous" href="/post/nodejs-event-loop/_payload.json?6fce0855-16c6-4058-b791-a60185c02409">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/B1kHp8qp.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/Dvr8koYW.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/8oskhlv7.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/DSkZmwCB.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/BV7Yc4PX.js">
<script type="module" src="/_nuxt/B1kHp8qp.js" crossorigin></script>
<link rel="shortcut icon" href="/favicon.ico">
<meta name="description" content="javascript event loop; Node.js 事件循环">
<meta name="keywords" content="翻译,JavaScript,Node.js,Event Loop"></head><body><div id="__nuxt"><div class="min-h-screen"><a href="#main-content" class="skip-link">跳到主要内容</a><header class="fixed top-0 left-0 right-0 z-50 h-16 border-b border-slate-200 dark:border-slate-700 bg-white/90 dark:bg-slate-900/90 backdrop-blur-xl shadow-sm transition-colors duration-300"><div class="max-w-content mx-auto px-6 h-full flex items-center justify-between gap-4"><a href="/" class="flex items-center gap-2.5 text-slate-900 dark:text-slate-100 font-semibold text-[17px] no-underline shrink-0 hover:text-blue-600 dark:hover:text-blue-400 transition-colors"><img src="/imgs/avatar.jpg" alt="文蔺" width="32" height="32" class="w-8 h-8 rounded-full object-cover"><span>文蔺的博客</span></a><nav id="main-nav" class="max-md:hidden flex items-center gap-0.5" aria-label="主导航"><!--[--><a href="/" class="px-3 py-1.5 text-sm text-slate-600 dark:text-slate-300 no-underline rounded-md whitespace-nowrap transition-colors hover:text-slate-900 dark:hover:text-slate-100 hover:bg-slate-100 dark:hover:bg-slate-800 max-md:px-3.5 max-md:py-2.5 max-md:text-[15px] max-md:w-full">主页</a><a href="/archives" class="px-3 py-1.5 text-sm text-slate-600 dark:text-slate-300 no-underline rounded-md whitespace-nowrap transition-colors hover:text-slate-900 dark:hover:text-slate-100 hover:bg-slate-100 dark:hover:bg-slate-800 max-md:px-3.5 max-md:py-2.5 max-md:text-[15px] max-md:w-full">归档</a><a href="/slides" class="px-3 py-1.5 text-sm text-slate-600 dark:text-slate-300 no-underline rounded-md whitespace-nowrap transition-colors hover:text-slate-900 dark:hover:text-slate-100 hover:bg-slate-100 dark:hover:bg-slate-800 max-md:px-3.5 max-md:py-2.5 max-md:text-[15px] max-md:w-full">Slides</a><a href="/about" class="px-3 py-1.5 text-sm text-slate-600 dark:text-slate-300 no-underline rounded-md whitespace-nowrap transition-colors hover:text-slate-900 dark:hover:text-slate-100 hover:bg-slate-100 dark:hover:bg-slate-800 max-md:px-3.5 max-md:py-2.5 max-md:text-[15px] max-md:w-full">关于</a><a href="/link" class="px-3 py-1.5 text-sm text-slate-600 dark:text-slate-300 no-underline rounded-md whitespace-nowrap transition-colors hover:text-slate-900 dark:hover:text-slate-100 hover:bg-slate-100 dark:hover:bg-slate-800 max-md:px-3.5 max-md:py-2.5 max-md:text-[15px] max-md:w-full">关注</a><a href="/collection" class="px-3 py-1.5 text-sm text-slate-600 dark:text-slate-300 no-underline rounded-md whitespace-nowrap transition-colors hover:text-slate-900 dark:hover:text-slate-100 hover:bg-slate-100 dark:hover:bg-slate-800 max-md:px-3.5 max-md:py-2.5 max-md:text-[15px] max-md:w-full">收藏</a><!--]--></nav><div class="flex items-center gap-1 shrink-0"><button class="inline-flex items-center justify-center w-9 h-9 rounded-md border-none bg-transparent text-slate-600 dark:text-slate-300 cursor-pointer transition-colors hover:text-slate-900 dark:hover:text-slate-100 hover:bg-slate-100 dark:hover:bg-slate-800" aria-label="切换到暗色模式" type="button"><svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></button><button class="hidden max-md:inline-flex items-center justify-center w-9 h-9 rounded-md border-none bg-transparent text-slate-600 dark:text-slate-300 cursor-pointer transition-colors hover:text-slate-900 dark:hover:text-slate-100 hover:bg-slate-100 dark:hover:bg-slate-800" aria-expanded="false" aria-controls="main-nav" aria-label="菜单" type="button"><svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false"><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button></div></div></header><!----><main id="main-content" role="main" class="pt-20 pb-10 min-h-[calc(100vh-200px)]"><!--[--><div class="max-w-prose mx-auto px-6 py-10"><article><div class="text-sm text-slate-600 dark:text-slate-300 mb-2"><time>2016-11-12</time></div><h1 class="text-2xl md:text-3xl font-bold text-slate-900 dark:text-slate-100 leading-tight mb-6 tracking-tight">[译] 理解 Node.js 事件循环</h1><div class="entry-content"><blockquote><p class="whitespace-nowrap overflow-hidden text-ellipsis"> 原文作者: <a target="_blank" href="https://blog.risingstack.com/author/tamas-kadlecsik/">Tamas Kadlecsik</a><br>原文地址: <a target="_blank" href="https://blog.risingstack.com/node-js-at-scale-understanding-node-js-event-loop/">https://blog.risingstack.com/node-js-at-scale-understanding-node-js-event-loop/</a><br>译文地址: <a target="_blank" href="https://angusfu.github.io/post/nodejs-event-loop">https://angusfu.github.io/post/nodejs-event-loop</a><br>本文由 <a target="_blank" href="https://angusfu.github.io">文蔺</a> 翻译，转载请保留此声明。 <br>著作权属于原作者，本译文仅用于学习、研究和交流目的，请勿用于商业目的。 </p></blockquote><!--[--><p>本文介绍了 Node.js 事件循环是如何工作，如何使用 Node.js 构建高速应用。文章还会涉及最常见的一些问题及其解决方案。</p><p>（我们正在编写一系列文章，聚焦于那些大规模使用 Node.js 的公司、有一定 Node 基础的开发者们的需求。）</p><p><strong>Node.js at Scale 系列章节:</strong></p><ul><li><p><strong>使用 npm</strong></p><ul><li><a href="https://blog.risingstack.com/nodejs-at-scale-npm-best-practices" target="_blank" rel="noopener">npm 技巧与最佳实践</a></li><li><a href="https://blog.risingstack.com/nodejs-at-scale-npm-publish-tutorial" target="_blank" rel="noopener">语义化版本和模块发布</a></li><li><a href="https://blog.risingstack.com/node-js-at-scale-module-system-commonjs-require" target="_blank" rel="noopener">理解 Module System、CommonJS 和 require</a></li></ul></li><li><p><strong>深入 Node.js 底层</strong></p><ul><li>Node.js 事件循环 (<strong>正是本文</strong>)</li><li>垃圾回收</li><li>编写元素模块</li></ul></li><li><p><strong>Building</strong></p><ul><li>Node.js 应用结构</li><li>代码整洁之道</li><li>异步处理</li><li>事件源（Event sourcing）</li><li>命令查询与责任隔离</li></ul></li><li><p><strong>Testing</strong></p><ul><li>单元测试</li><li>E2E 测试</li></ul></li><li><p><strong>生产环境的 Node.js</strong></p><ul><li>应用监控</li><li>应用调试</li><li>应用分析</li></ul></li><li><p><strong>微服务</strong></p><ul><li>请求签名（Request Signing）</li><li>分布式跟踪（Distributed Tracing）</li><li>API 网关（API Gateways）</li></ul></li></ul><hr><h2>问题提出</h2><p>多数网站后端是不需要进行复杂运算的。程序多数时间都在等待进行硬盘读写，等待网络传输信息、响应返回。</p><p>IO 操作可能比数据处理要慢几个数量级。举个例子，SSD 可以达到 200-730 MB/s 的速度 —— 至少高端 SSD 可以做到。读取 1KB 数据仅需要 1.4μs，但同样的时间里，主频 2GHz 的 CPU 可以完成 28,000 次指令处理周期。</p><p>对网络通信来说，情况还可能更糟糕，ping 下 google.com 试试看：</p><pre><code>$ ping google.com
64 bytes from 172.217.16.174: icmp_seq=0 ttl=52 time=33.017 ms  
64 bytes from 172.217.16.174: icmp_seq=1 ttl=52 time=83.376 ms  
64 bytes from 172.217.16.174: icmp_seq=2 ttl=52 time=26.552 ms  
64 bytes from 172.217.16.174: icmp_seq=3 ttl=52 time=40.153 ms  
64 bytes from 172.217.16.174: icmp_seq=4 ttl=52 time=37.291 ms  
64 bytes from 172.217.16.174: icmp_seq=5 ttl=52 time=58.692 ms  
64 bytes from 172.217.16.174: icmp_seq=6 ttl=52 time=45.245 ms  
64 bytes from 172.217.16.174: icmp_seq=7 ttl=52 time=27.846 ms 
</code></pre><p>平均延时为 44ms。数据包在网络上一个来回，前面提到的处理器可以执行 8800 万次周期。</p><h2>解决方案</h2><p>多数操作系统都提供了某种类型的异步 IO 接口，在允许我们在处理那些不依赖于通信结果的数据之外，通信还能继续...</p><p>数种方式可以达到此目的。如今的完成方式，主要是以额外的软件复杂性为代价，挖掘多线程潜力。比方说，在 Java 或 Python 中，文件读取是阻塞操作。在等待网络/硬盘通信（network/disk communication）完成时，程序无法做任何其他工作。我们能做的 —— 至少在 Java 中是如此 —— 只能是启动新的线程，然后在操作完成后通知主线程。</p><p>既枯燥又复杂，但能完成任务。那 Node 是怎样的呢？好吧，因为 Node.js（更准确的说是 V8） 是单线程的，我们肯定也会遇到同样的问题。我们代码只能在一个线程中运行。</p><p><strong>编者按</strong>: 这里所说的并非完全正确。Java 和 Python 都有异步接口，但使用起来要比 Node.js 麻烦得多。感谢 <a href="https://disqus.com/by/keidi19/" target="_blank" rel="noopener">Shahar</a> 和 <a href="https://twitter.com/dirkjharrington" target="_blank" rel="noopener">Dirk Harrington</a> 指正。</p><p>也许你知道，有时候，在浏览器中用 <code>setTimeout(someFunction, 0)</code> 能够神奇地解决一些问题。可是为什么将超时时间设置为 0，将执行延迟 0ms 就能解决问题？难道和立即调用 <code>someFunction</code> 不是一回事吗？并非如此。</p><p>首先，来看看调用栈（call stack），又简称作“栈”。我会尽量将问题简化，因为我们只需要理解调用栈的最基本概念。如果你对此已经熟悉，请直接<a href="#事件循环">跳到下一节吧</a>。</p><h2>调用栈</h2><p>调用一个函数时，返回地址（return address）、参数（arguments）、本地变量（local variables）等都会被推入栈中。如果在当前正在运行的函数中调用另一个函数，则该函数的相关内容也会以同样的方式推到栈顶。</p><p>为行文简便，接下来我将使用“函数被推入栈顶”这样不太准确的表达。</p><p>来看看吧！（<strong>译者注：下面的示意图中的一些地方将 <code>square</code> 误作 <code>sqrt</code>，请根据代码甄别。</strong>）</p><pre><code class="hljs lang-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span> (<span class="hljs-params"></span>) {
  <span class="hljs-keyword">const</span> hypotenuse = <span class="hljs-title function_">getLengthOfHypotenuse</span>(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(hypotenuse)
}
 
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getLengthOfHypotenuse</span>(<span class="hljs-params">a, b</span>) {
  <span class="hljs-keyword">const</span> squareA = <span class="hljs-title function_">square</span>(a)
  <span class="hljs-keyword">const</span> squareB = <span class="hljs-title function_">square</span>(b)
  <span class="hljs-keyword">const</span> sumOfSquares = squareA + squareB
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(sumOfSquares)  
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">square</span>(<span class="hljs-params">number</span>) {  
  <span class="hljs-keyword">return</span> number * number  
}

<span class="hljs-title function_">main</span>()
</code></pre><p>首先调用 <code>main</code> 函数：</p><p><img loading="lazy" src="https://p0.ssl.qhimg.com/t01ce56e785b8ca1925.png" alt="The main function"></p><p>紧接着以 3 和 4 为参数，调用 <code>getLengthOfHypotenuse</code> 函数：</p><p><img loading="lazy" src="https://p0.ssl.qhimg.com/t01638ef1f34edebd4b.png" alt="The getLengthOfHypotenuse function"></p><p>然后是 <code>square(a)</code>：</p><p><img loading="lazy" src="https://p0.ssl.qhimg.com/t01853c10926172f492.png" alt="The square(a) function"></p><p><code>square(a)</code> 返回后，从栈中弹出，其返回值赋值给 <code>squareA</code>。然后 <code>squareA</code> 被添加到 <code>getLengthOfHypotenuse</code> 的调用帧中：</p><p><img loading="lazy" src="https://p0.ssl.qhimg.com/t0131d9d440676ac6db.png" alt="Variable a"></p><p>下面计算 <code>square(b)</code> 也是一样：</p><p><img loading="lazy" src="https://p0.ssl.qhimg.com/t01d0940a2e39afc9b8.png" alt="The square(b) function"></p><p><img loading="lazy" src="https://p0.ssl.qhimg.com/t01e3c678adc983fe06.png" alt="Variable b"></p><p>下一行是表达式 <code>squareA + squareB</code> 求值：</p><p><img loading="lazy" src="https://p0.ssl.qhimg.com/t01a6f422d209f22c87.png" alt="sumOfSquares"></p><p>计算 <code>Math.sqrt(sumOfSquares)</code>:</p><p><img loading="lazy" src="https://p0.ssl.qhimg.com/t01a839e63df37022d1.png" alt="Math.sqrt"></p><p>现在 <code>getLengthOfHypotenuse</code> 剩下的工作就是将计算的最终结果返回：</p><p><img loading="lazy" src="https://p0.ssl.qhimg.com/t018965143c9066d384.png" alt="The return function"></p><p><code>getLengthOfHypotenuse</code> 返回值被赋值给 <code>main</code> 中的 <code>hypotenuse</code>：</p><p><img loading="lazy" src="https://p0.ssl.qhimg.com/t0151eb79acb5966784.png" alt="hypotenuse"></p><p>控制台打印出 <code>hypotenuse</code>：</p><p><img loading="lazy" src="https://p0.ssl.qhimg.com/t0103341d998752b217.png" alt="The console log"></p><p>然后，<code>main</code> 返回，不带任何值，并从栈中弹出，栈变为空。</p><p><img loading="lazy" src="https://p0.ssl.qhimg.com/t01d03e975bae0fee94.png" alt="Finally"></p><p><strong>注意</strong>： 上面提到函数执行完毕后，本地变量从栈中弹出。这仅对 Number、String、Boolean 等基本类型的值成立。对象、数组等值位于堆（heap）中，变量只是指向它们的指针。传递的变量其实只是指针，让这些值在不同的栈帧中可变化。当函数从栈中弹出后，只有指针弹出，而实际值依然还在堆中。当对象失去作用后，由垃圾回收器释放空间。</p><h2>事件循环</h2><p><img loading="lazy" src="https://p0.ssl.qhimg.com/t01c3a8e7546481b4ee.gif" alt="The Node.js Event Loop - cat version"></p><p>不不不，不是这种循环。 :)</p><p>所以，当我们调用 <code>setTimeout</code>、<code>http.get</code>、<code>process.nextTick</code> 或 <code>fs.readFile</code> 这样一些东西时，到底发生了什么？V8 代码没有这些，但 Chrome WebApi 和 Node.js 的 C++ API 中有。要了解它们，我们得更好地理解执行顺序。</p><p>看看一个更一般的 Node.js 应用 —— 监听 <code>localhost:3000/</code> 的服务器。收到请求时，服务器会在控制台上打印一些消息，请求 <code>wttr.in/</code>，然后将接收的响应转发给请求者。</p><pre><code class="hljs lang-javascript"><span class="hljs-meta">&#39;use strict&#39;</span> 
<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#39;express&#39;</span>)  
<span class="hljs-keyword">const</span> superagent = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#39;superagent&#39;</span>)  
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>()

app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#39;/&#39;</span>, sendWeatherOfRandomCity)

<span class="hljs-keyword">function</span> <span class="hljs-title function_">sendWeatherOfRandomCity</span> (<span class="hljs-params">request, response</span>) {  
  <span class="hljs-title function_">getWeatherOfRandomCity</span>(request, response)
  <span class="hljs-title function_">sayHi</span>()
}

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">CITIES</span> = [  
  <span class="hljs-string">&#39;london&#39;</span>,
  <span class="hljs-string">&#39;newyork&#39;</span>,
  <span class="hljs-string">&#39;paris&#39;</span>,
  <span class="hljs-string">&#39;budapest&#39;</span>,
  <span class="hljs-string">&#39;warsaw&#39;</span>,
  <span class="hljs-string">&#39;rome&#39;</span>,
  <span class="hljs-string">&#39;madrid&#39;</span>,
  <span class="hljs-string">&#39;moscow&#39;</span>,
  <span class="hljs-string">&#39;beijing&#39;</span>,
  <span class="hljs-string">&#39;capetown&#39;</span>,
]

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getWeatherOfRandomCity</span> (<span class="hljs-params">request, response</span>) {  
  <span class="hljs-keyword">const</span> city = <span class="hljs-variable constant_">CITIES</span>[<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-variable constant_">CITIES</span>.<span class="hljs-property">length</span>)]
  superagent.<span class="hljs-title function_">get</span>(<span class="hljs-string">`wttr.in/<span class="hljs-subst">${city}</span>`</span>)
    .<span class="hljs-title function_">end</span>(<span class="hljs-function">(<span class="hljs-params">err, res</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (err) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#39;O snap&#39;</span>)
        <span class="hljs-keyword">return</span> response.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&#39;There was an error getting the weather, try looking out the window&#39;</span>)
      }
      <span class="hljs-keyword">const</span> responseText = res.<span class="hljs-property">text</span>
      response.<span class="hljs-title function_">send</span>(responseText)
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#39;Got the weather&#39;</span>)
    })

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#39;Fetching the weather, please be patient&#39;</span>)
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">sayHi</span> (<span class="hljs-params"></span>) {  
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#39;Hi&#39;</span>)
}

app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>) 
</code></pre><p>请求 <code>localhost:3000</code> 时，除了获取天气，还有哪些内容打印出来？</p><p>如果你在 Node 方面有些经验，肯定不会惊讶：在代码中，尽管调用 <code>console.log(&#39;Fetching the weather, please be patient&#39;)</code> 在 <code>console.log(&#39;Got the weather&#39;)</code> 之后，当前者会先打印出来：</p><pre><code class="hljs lang-bash">Fetching the weather, please be patient  
Hi  
Got the weather 
</code></pre><p>发生了什么？就算 V8 是单线程的，Node 底层的 C++ API 并不是啊。这意味着，无论何时调用非阻塞的操作，Node 会在底层调用一些和 JavaScript 代码同时运行的代码。一旦该隐藏线程接收到等待的值或者抛出错误，就会传入必要参数，调用提供的回调。</p><p><strong>注意</strong>： 上面所谓的“一些和 JavaScript 代码同时运行的代码”，实际上是 <a href="https://github.com/libuv/libuv" target="_blank" rel="noopener">libuv</a> 的一部分。libuv 是处理线程池的开源库，用于处理信号，以及异步任务执行所必要的其他东西。一开始是为 Node.js 开发的，不过目前也有<a href="https://github.com/libuv/libuv/wiki/Projects-that-use-libuv" target="_blank" rel="noopener">很多其他项目</a>在使用。</p><p>为了深入底层，我们需要引入两个新概念：事件循环（event loop）和任务队列（task queue）。</p><h3>任务队列</h3><p>Javascript 是单线程、事件驱动型语言。这意味着，我们可以为事件添加监听器，当某一事件触发时，监听器执行提供的回调。</p><p>调用 <code>setTimeout</code>、<code>http.get</code> 或 <code>fs.readFile</code> 时，Node.js 将这些操作发送到另外一个线程，允许 V8 继续执行代码。计时完毕或 IO/http 操作完成后，Node 还会调用回调函数。</p><p>然后这些回调也可以将其他任务入列，其余亦可依此类推。这样，在处理请求时还能读取文件，并根据读取的内容发送 http 请求，而不会阻塞正在处理的其他请求。</p><p>尽管如此，我们只有一个主线程加一个调用栈，所以为避免在读取那个文件时又去处理另一个请求，回调函数需要等待调用栈变空。回调函数等待执行的中间状态被称为任务队列（又称作事件队列、消息队列）。一旦主线程结束此前工作，回调函数就会在一个无限循环当中被调用，因此叫作“事件循环”。（译者注：附原文如下）</p><blockquote><p>However, we only have one main thread and one call-stack, so in case there is another request being served when the said file is read, its callback will need to wait for the stack to become empty. The limbo where callbacks are waiting for their turn to be executed is called the task queue (or event queue, or message queue). Callbacks are being called in an infinite loop whenever the main thread has finished its previous task, hence the name &#39;event loop&#39;.</p></blockquote><p>在上一个例子中，事件循环大概如下所述：</p><ol><li><p>express 为“request”事件注册了一个处理程序，请求 “/” 时会被调用；</p></li><li><p>跳过函数，开始监听 3000 端口；</p></li><li><p>调用栈为空，等待“request”事件触发；</p></li><li><p>请求到来，等待已久的事件触发，express 调用 <code>sendWeatherOfRandomCity</code>；</p></li><li><p><code>sendWeatherOfRandomCity</code> 入栈；</p></li><li><p><code>getWeatherOfRandomCity</code> 被调用并入栈；</p></li><li><p>调用 <code>Math.floor</code> 和 <code>Math.random</code>，入栈、出栈，<code>cities</code> 中的某一个被赋值给 <code>city</code>；</p></li><li><p>传入 <code>&#39;wttr.in/${city}&#39;</code> 调用 <code>superagent.get</code>，为 <code>end</code> 事件设置处理回调；</p></li><li><p>发送 <code>http://wttr.in/${city}</code> http 请求到底层线程，继续向下执行；</p></li><li><p>控制台打印 <code>&#39;Fetching the weather, please be patient&#39;</code>，<code>getWeatherOfRandomCity</code> 函数返回；</p></li><li><p>调用 <code>sayHi</code>，控制台打印 <code>&#39;Hi&#39;</code>；</p></li><li><p><code>sendWeatherOfRandomCity</code> 函数返回、出栈，调用栈变空；</p></li><li><p>等待 <code>http://wttr.in/${city}</code> 发送响应；</p></li><li><p>一旦响应返回，<code>end</code> 事件触发；</p></li><li><p>传给 <code>.end()</code> 的匿名回调函数调用，带着其闭包内所有变量一起入栈，也就是说，其内部能够访问、修改 <code>express, superagent, app, CITIES, request, response, city</code> 以及我们定义的函数；</p></li><li><p>调用 <code>response.send()</code>，状态码为 <code>200</code> 或 <code>500</code>，再次发送到底层线程，response stream 不会阻塞代码执行，匿名回调出栈。</p></li></ol><p>这样我们就能理解一开始提到的 <code>setTimeout</code> hack 是如何工作的。尽管将时间设置为 0，但是会延迟到当前栈和任务队列为空后执行，以允许浏览器重新绘制 UI，或 Node 处理其他请求。</p><h3>Microtask 与 Macrotask</h3><p>实际上，不止一个任务队列，microtask（小型任务） 与 macrotask（巨型任务）各有一个任务队列。</p><p>Microtask 如：</p><ul><li><p><code>process.nextTick</code></p></li><li><p><code>promises</code></p></li><li><p><code>Object.observe</code></p></li></ul><p>Macrotask 如：</p><ul><li><p><code>setTimeout</code></p></li><li><p><code>setInterval</code></p></li><li><p><code>setImmediate</code></p></li><li><p><code>I/O</code></p></li></ul><p>看看下面的代码：</p><pre><code class="hljs lang-javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#39;script start&#39;</span>)

<span class="hljs-keyword">const</span> interval = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {  
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#39;setInterval&#39;</span>)
}, <span class="hljs-number">0</span>)

<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {  
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#39;setTimeout 1&#39;</span>)
  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#39;promise 3&#39;</span>)
  }).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#39;promise 4&#39;</span>)
  }).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#39;setTimeout 2&#39;</span>)
      <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#39;promise 5&#39;</span>)
      }).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#39;promise 6&#39;</span>)
      }).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-built_in">clearInterval</span>(interval)
      })
    }, <span class="hljs-number">0</span>)
  })
}, <span class="hljs-number">0</span>)

<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {  
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#39;promise 1&#39;</span>)
}).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#39;promise 2&#39;</span>)
}) 
</code></pre><p>控制台结果如下：</p><pre><code class="hljs lang-bash">script start  
promise1  
promise2  
setInterval  
setTimeout1  
promise3  
promise4  
setInterval  
setTimeout2  
setInterval  
promise5  
promise6 
</code></pre><p>按照 <a href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue" target="_blank" rel="noopener">WHATWG</a> 规范，每一次事件循环（one cycle of the event loop），只处理一个 (macro)task。待该 macrotask 完成后，所有的 microtask 会在同一次循环中处理。处理这些 microtask 时，还可以将更多的 microtask 入队，它们会一一执行，直到整个 microtask 队列处理完。</p><p>下图展示得更加清楚：</p><p><img loading="lazy" src="https://p0.ssl.qhimg.com/t01134d053300881c3b.png" alt="The Node.js Event Loop"></p><p>在上面的例子中：</p><p><strong>Cycle 1:</strong></p><ol><li><p><code>setInterval</code> 加入 macrotask 队列；</p></li><li><p><code>setTimeout 1</code> 加入 macrotask 队列；</p></li><li><p><code>Promise.resolve 1</code> 中，两个 <code>then</code> 加入 microtask 队列；</p></li><li><p>调用栈变空，microtask 执行。</p></li></ol><p>Macrotask queue: <code>setInterval</code>, <code>setTimeout 1</code></p><p><strong>Cycle 2:</strong></p><ol start="5"><li>microtask 队列为空，<code>setInteval</code> 回调执行，又一个 <code>setInterval</code> 加入 macrotask 队列，正好位于 <code>setTimeout 1</code> 之后；</li></ol><p>Macrotask queue: <code>setTimeout 1</code>, <code>setInterval</code></p><p><strong>Cycle 3:</strong></p><ol start="6"><li><p>microtask 队列为空，<code>setTimeout 1</code> 回调执行，<code>promise 3</code> 和 <code>promise 4</code> 加入 microtask 队列；</p></li><li><p><code>promise 3</code> 和 <code>promise 4</code> 执行，<code>setTimeout 2</code> 加入 macrotask 队列；</p></li></ol><p>Macrotask queue: <code>setInterval</code>, <code>setTimeout 2</code></p><p><strong>Cycle 4:</strong></p><ol start="8"><li>microtask 队列为空，<code>setInteval</code> 回调执行，另一个 <code>setInterval</code> 加入 macrotask 队列，正好位于 <code>setTimeout 2</code> 之后；</li></ol><p>Macrotask queue: <code>setTimeout 2</code>, <code>setInteval</code></p><ol start="9"><li><code>setTimeout 2</code> 回调执行，<code>promise 5</code> 和 <code>promise 6</code> 加入 microtask 队列；</li></ol><p>紧接着，<code>promise 5</code> 和 <code>promise 6</code> 的处理程序会清除 interval，但奇怪的是，<code>setInterval</code> 还是运行了一次。不过，如果在 Chrome 中运行代码，结果和预期是一致的。</p><div class="tip"> **译者注**：笔者实际测试发现，情况可能和上面的叙述有所不同。Node v5.12 执行的结果是符合预期的。而 Chrome 53 上，反而出现一些状况，`promise 4` 之后，`setInterval` 执行了两次，原因未详，有待进一步追踪（disqus 评论被墙，我的 VPN 也没戏）。 </div><p>使用 <code>process.nextTick</code> 和一些嵌套回调，在也 Node 中也能修复问题：</p><pre><code class="hljs lang-javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#39;script start&#39;</span>)

<span class="hljs-keyword">const</span> interval = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {  
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#39;setInterval&#39;</span>)
}, <span class="hljs-number">0</span>)

<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {  
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#39;setTimeout 1&#39;</span>)
  process.<span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#39;nextTick 3&#39;</span>)
    process.<span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#39;nextTick 4&#39;</span>)
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#39;setTimeout 2&#39;</span>)
        process.<span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#39;nextTick 5&#39;</span>)
          process.<span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#39;nextTick 6&#39;</span>)
            <span class="hljs-built_in">clearInterval</span>(interval)
          })
        })
      }, <span class="hljs-number">0</span>)
    })
  })
})

process.<span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> {  
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#39;nextTick 1&#39;</span>)
  process.<span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#39;nextTick 2&#39;</span>)
  })
}) 
</code></pre><p>这和上面的逻辑基本一样，只是看起来比较可怕。至少工作按照预期完成了。</p><h3>驯服异步怪兽！</h3><p>如前所见，在编写 Node.js 应用时，需要管理、留心两个任务队列和事件循环 —— 如果想要发挥它们全部的理力量，如果需要避免耗时任务阻塞主线程。</p><p>事件循环的概念一开始可能不太好掌握，一旦掌握之后就再也离不开了。可能导致回调地狱的延续传递风格看起来很丑，不过我们有 Promise，很快还有 async-await 在手... 在等待 async-await 的时候，还可以使用 <a href="https://github.com/tj/co" target="_blank" rel="noopener">co</a>、<a href="http://koajs.com/" target="_blank" rel="noopener">koa</a> 这些工具。</p><p>最后一点建议：</p><p>了解了 Node.js 和 V8 如何处理长时间任务，可以开始尝试使用。你之前可能听说过，应当将耗时循环放入任务队列。可以手动去做，或者借助 <a href="http://caolan.github.io/async/" target="_blank" rel="noopener">async.js</a>。</p><p>祝你搬砖愉快！如果有什么问题或想法，请在评论中提出。</p><!--]--></div></article><nav class="flex items-center justify-between gap-4 pt-8 mt-8 border-t border-slate-200 dark:border-slate-700 max-md:flex-col max-md:gap-3" aria-label="文章导航"><a href="/post/fishing-for-spider" class="inline-flex items-center gap-1 px-4 py-2 text-sm text-slate-600 dark:text-slate-300 border border-slate-200 dark:border-slate-700 rounded-md no-underline transition-all hover:text-blue-600 dark:hover:text-blue-400 hover:border-blue-600 dark:hover:border-blue-400 max-w-[45%] max-md:max-w-full max-md:w-full max-md:justify-center truncate" title="快来上钩哈哈哈">« 快来上钩哈哈哈</a><a href="/post/algo-bubble-sort" class="inline-flex items-center gap-1 px-4 py-2 text-sm text-slate-600 dark:text-slate-300 border border-slate-200 dark:border-slate-700 rounded-md no-underline transition-all hover:text-blue-600 dark:hover:text-blue-400 hover:border-blue-600 dark:hover:border-blue-400 max-w-[45%] max-md:max-w-full max-md:w-full max-md:justify-center truncate" title="算法学习：冒泡排序">算法学习：冒泡排序 »</a></nav></div><!--]--></main><footer class="border-t border-slate-200 dark:border-slate-700 py-10 px-6 text-center text-sm text-slate-600 dark:text-slate-300 transition-colors" role="contentinfo"><div class="max-w-content mx-auto"><div class="flex justify-center gap-6 mb-5"><a href="https://github.com/AngusFu/" target="_blank" rel="noopener nofollow" class="inline-flex items-center gap-1.5 text-slate-600 dark:text-slate-300 text-sm transition-colors hover:text-slate-900 dark:hover:text-slate-100"><svg class="w-[18px] h-[18px]" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" focusable="false"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg><span>GitHub</span></a><a href="/atom.xml" target="_blank" rel="noopener" class="inline-flex items-center gap-1.5 text-slate-600 dark:text-slate-300 text-sm transition-colors hover:text-slate-900 dark:hover:text-slate-100"><svg class="w-[18px] h-[18px]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg><span>RSS</span></a></div><div><p class="m-0 leading-relaxed"> © 2026 文蔺的博客 <span> · </span><a href="/" class="text-slate-600 dark:text-slate-300 hover:text-blue-600 dark:hover:text-blue-400">angusfu.github.io</a></p><p class="m-0 mt-1 opacity-70"> Powered by <a target="_blank" rel="noopener" href="https://nuxt.com" class="text-slate-600 dark:text-slate-300 hover:text-blue-600 dark:hover:text-blue-400">Nuxt</a></p></div></div></footer></div></div><div id="teleports"></div><script>window.__NUXT__={};window.__NUXT__.config={public:{title:"文蔺的博客",description:"文蔺的前端学习记录，国外技术文章翻译，个人学习心得等等这些都会记录在这里。",favicon:"/img/favicon.ico",site_owner:"文蔺",hostname:"angusfu.github.io",github_url:"https://github.com/AngusFu/",logo_url:"/imgs/avatar.jpg",navigation:[{url:"/",option:"home",label:"主页"},{url:"/archives",option:"archive",label:"归档"},{url:"/slides",option:"archive",label:"Slides"},{url:"/about",option:"user",label:"关于"},{url:"/link",option:"link",label:"关注"},{url:"/collection",option:"archive",label:"收藏"}],page_size:10,site_url:"https://angusfu.github.io"},app:{baseURL:"/",buildId:"6fce0855-16c6-4058-b791-a60185c02409",buildAssetsDir:"/_nuxt/",cdnURL:""}}</script>
<script type="application/json" data-nuxt-data="nuxt-app" data-ssr="true" id="__NUXT_DATA__" data-src="/post/nodejs-event-loop/_payload.json?6fce0855-16c6-4058-b791-a60185c02409">[{"state":1,"once":3,"_errors":4,"serverRendered":6,"path":7,"prerenderedAt":8},["Reactive",2],{},["Set"],["ShallowReactive",5],{},true,"/post/nodejs-event-loop",1769838254871]</script></body></html>