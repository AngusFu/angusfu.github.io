<!DOCTYPE html><html><head><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
<title>[译] WebAssembly  初尝 | 文蔺的博客</title>
<style>body{color:#666;margin:0;padding:0;-webkit-text-size-adjust:none;transition:transform .2s cubic-bezier(.4,.01,.165,.99);-webkit-tap-highlight-color:transparent;font-family:Helvetica Neue,Arial,Hiragino Sans GB,STHeiti,Microsoft YaHei;-webkit-font-smoothing:antialiased;-webkit-overflow-scrolling:touch}body,html{height:100%;width:100%}h1,h2,h3,h4,h5,h6{margin:0;padding:0}a,a:hover{color:#2479cc;text-decoration:none}ol,ul{padding:0}*{box-sizing:border-box}body.side{position:fixed;transform:translate3D(250px,0,0)}#main{background-color:#fff;max-width:1390px;padding-left:290px;padding-right:40px;-webkit-overflow-scrolling:touch}h1.intro{background-color:#f6f9fa;color:#999;padding:20px 30px;text-align:center}textarea.codespan,textarea.pre-area{display:none}.nuxt-progress{background-color:#d59613!important}@font-face{font-family:iconfont;src:url(/_nuxt/iconfont.CmbQAa6e.eot);src:url(/_nuxt/iconfont.CmbQAa6e.eot?#iefix) format("embedded-opentype"),url(/_nuxt/iconfont.DzG65zpK.ttf) format("truetype"),url(/_nuxt/iconfont.BPH69LT9.svg#iconfont) format("svg")}.iconfont{font-family:iconfont!important;font-size:16px;font-style:normal;-webkit-font-smoothing:antialiased;-webkit-text-stroke-width:.2px;-moz-osx-font-smoothing:grayscale}.icon-weibo:before{content:""}.icon-archive:before{content:""}.icon-user:before{content:""}.icon-rss-v:before{content:""}.icon-tags:before{content:""}.icon-home:before{content:""}.icon-search:before{content:""}.icon-googleplus:before{content:""}.icon-weixin:before{content:""}.icon-mail:before{content:""}.icon-twitter-v:before{content:""}.icon-linkedin:before{content:""}.icon-stackoverflow:before{content:""}.icon-github-v:before{content:""}.icon-facebook:before{content:""}.icon-right:before{content:""}.icon-left:before{content:""}.icon-link:before{content:""}.icon-https:before{content:""}.hljs{background:#fff;color:#333;display:block;overflow-x:auto;padding:.5em;-webkit-text-size-adjust:none}.hljs-comment,.lang-bash .hljs-shebang,.lang-java .hljs-javadoc,.lang-javascript .hljs-javadoc,.lang-rust .hljs-preprocessor{color:#969896}.hljs-string,.lang-apache .hljs-sqbracket,.lang-c .hljs-preprocessor,.lang-coffeescript .hljs-regexp,.lang-coffeescript .hljs-subst,.lang-cpp .hljs-preprocessor,.lang-javascript .hljs-regexp,.lang-json .hljs-attribute,.lang-less .hljs-built_in,.lang-makefile .hljs-variable,.lang-markdown .hljs-blockquote,.lang-markdown .hljs-emphasis,.lang-markdown .hljs-link_label,.lang-markdown .hljs-strong,.lang-markdown .hljs-value,.lang-nginx .hljs-number,.lang-nginx .hljs-regexp,.lang-objectivec .hljs-preprocessor .hljs-title,.lang-perl .hljs-regexp,.lang-php .hljs-regexp,.lang-scss .hljs-built_in,.lang-xml .hljs-value{color:#df5000}.hljs-keyword,.lang-css .hljs-at_rule,.lang-css .hljs-important,.lang-go .hljs-typename,.lang-haskell .hljs-type,.lang-http .hljs-request,.lang-ini .hljs-setting,.lang-java .hljs-javadoctag,.lang-javascript .hljs-javadoctag,.lang-javascript .hljs-tag,.lang-less .hljs-at_rule,.lang-less .hljs-tag,.lang-nginx .hljs-title,.lang-objectivec .hljs-preprocessor,.lang-php .hljs-phpdoc,.lang-scss .hljs-at_rule,.lang-scss .hljs-important,.lang-scss .hljs-tag,.lang-sql .hljs-built_in,.lang-stylus .hljs-at_rule,.lang-swift .hljs-preprocessor{color:#a71d5d}.lang-apache .hljs-cbracket,.lang-apache .hljs-common,.lang-apache .hljs-keyword,.lang-bash .hljs-built_in,.lang-bash .hljs-literal,.lang-c .hljs-built_in,.lang-c .hljs-number,.lang-coffeescript .hljs-built_in,.lang-coffeescript .hljs-literal,.lang-coffeescript .hljs-number,.lang-cpp .hljs-built_in,.lang-cpp .hljs-number,.lang-cs .hljs-built_in,.lang-cs .hljs-number,.lang-css .hljs-attribute,.lang-css .hljs-function,.lang-css .hljs-hexcolor,.lang-css .hljs-number,.lang-go .hljs-built_in,.lang-go .hljs-constant,.lang-haskell .hljs-number,.lang-http .hljs-attribute,.lang-http .hljs-literal,.lang-java .hljs-number,.lang-javascript .hljs-built_in,.lang-javascript .hljs-literal,.lang-javascript .hljs-number,.lang-json .hljs-number,.lang-less .hljs-attribute,.lang-less .hljs-function,.lang-less .hljs-hexcolor,.lang-less .hljs-number,.lang-makefile .hljs-keyword,.lang-markdown .hljs-link_reference,.lang-nginx .hljs-built_in,.lang-objectivec .hljs-built_in,.lang-objectivec .hljs-literal,.lang-objectivec .hljs-number,.lang-php .hljs-literal,.lang-php .hljs-number,.lang-puppet .hljs-function,.lang-python .hljs-number,.lang-ruby .hljs-constant,.lang-ruby .hljs-number,.lang-ruby .hljs-prompt,.lang-ruby .hljs-subst .hljs-keyword,.lang-ruby .hljs-symbol,.lang-rust .hljs-number,.lang-scss .hljs-attribute,.lang-scss .hljs-function,.lang-scss .hljs-hexcolor,.lang-scss .hljs-number,.lang-scss .hljs-preprocessor,.lang-sql .hljs-number,.lang-stylus .hljs-attribute,.lang-stylus .hljs-hexcolor,.lang-stylus .hljs-number,.lang-stylus .hljs-params,.lang-swift .hljs-built_in,.lang-swift .hljs-number{color:#0086b3}.lang-apache .hljs-tag,.lang-cs .hljs-xmlDocTag,.lang-css .hljs-tag,.lang-stylus .hljs-tag,.lang-xml .hljs-title{color:#63a35c}.lang-bash .hljs-variable,.lang-cs .hljs-preprocessor,.lang-cs .hljs-preprocessor .hljs-keyword,.lang-css .hljs-attr_selector,.lang-css .hljs-value,.lang-ini .hljs-keyword,.lang-ini .hljs-value,.lang-javascript .hljs-tag .hljs-title,.lang-makefile .hljs-constant,.lang-nginx .hljs-variable,.lang-scss .hljs-variable,.lang-xml .hljs-tag{color:#333}.lang-bash .hljs-title,.lang-c .hljs-title,.lang-coffeescript .hljs-title,.lang-cpp .hljs-title,.lang-cs .hljs-title,.lang-css .hljs-class,.lang-css .hljs-id,.lang-css .hljs-pseudo,.lang-diff .hljs-chunk,.lang-haskell .hljs-pragma,.lang-haskell .hljs-title,.lang-ini .hljs-title,.lang-java .hljs-title,.lang-javascript .hljs-title,.lang-less .hljs-class,.lang-less .hljs-id,.lang-less .hljs-pseudo,.lang-makefile .hljs-title,.lang-objectivec .hljs-title,.lang-perl .hljs-sub,.lang-php .hljs-title,.lang-puppet .hljs-title,.lang-python .hljs-decorator,.lang-python .hljs-title,.lang-ruby .hljs-parent,.lang-ruby .hljs-title,.lang-rust .hljs-title,.lang-scss .hljs-class,.lang-scss .hljs-id,.lang-scss .hljs-pseudo,.lang-stylus .hljs-class,.lang-stylus .hljs-id,.lang-stylus .hljs-pseudo,.lang-stylus .hljs-title,.lang-swift .hljs-title,.lang-xml .hljs-attribute{color:#795da3}.lang-coffeescript .hljs-attribute,.lang-coffeescript .hljs-reserved{color:#1d3e81}.lang-diff .hljs-chunk{font-weight:700}.lang-diff .hljs-addition{background-color:#eaffea;color:#55a532}.lang-diff .hljs-deletion{background-color:#ffecec;color:#bd2c00}.lang-markdown .hljs-link_url{text-decoration:underline}#sidebar{background-color:#202020;height:100%;left:0;overflow:auto;position:fixed;top:0;width:250px;z-index:1;-webkit-overflow-scrolling:touch}#sidebar li,#sidebar ul{list-style:none;margin:0;padding:0}#sidebar .profile{padding-bottom:10px;padding-top:40px}#sidebar .profile a,#sidebar .profile img{border-radius:70px;height:140px;overflow:hidden;width:140px}#sidebar .profile a{display:block;margin:0 auto}#sidebar .profile span{color:#999;display:block;font-size:18px;padding:10px 0;text-align:center}#sidebar .buttons{margin:0 0 20px}#sidebar .buttons li{display:block;font-size:16px;height:45px;line-height:45px;width:100%}#sidebar .buttons li a{color:#999;display:block;padding-left:25px;text-decoration:none;transition:color .2s cubic-bezier(.4,.01,.165,.99)}#sidebar .buttons li a i,#sidebar .buttons li a span{display:inline-block;vertical-align:middle}#sidebar .buttons li a i{font-size:20px;height:45px;line-height:45px;margin-right:20px;text-align:center;width:25px}#sidebar .buttons li a:hover{color:#999c}#sidebar .buttons li a.inline{display:inline-block;width:40px}#sidebar-mask{background-color:#fff0;display:none;inset:0;overflow:hidden;position:absolute;z-index:999}#header{background-color:#323436;display:none;height:50px;left:0;line-height:50px;overflow:hidden;position:fixed;top:0;width:100%;z-index:9}body.side #header .btn-bar:before{top:25px;transform:rotate(-45deg);width:24px}body.side #header .btn-bar:after{bottom:24px;transform:rotate(45deg);width:24px}body.side #header .btn-bar i{opacity:0}#header h1{font-size:16px;text-align:center}#header h1 a{color:#999}#header .btn-bar{height:50px;left:0;position:absolute;top:0;width:50px}#header .btn-bar i,#header .btn-bar:after,#header .btn-bar:before{background-color:#999;height:1px;left:14px;position:absolute;transition:all .2s cubic-bezier(.4,.01,.165,.99) .3s;width:22px}#header .btn-bar i{opacity:1;top:25px}#header .btn-bar:before{content:"";top:17px}#header .btn-bar:after{bottom:16px;content:""}#header a.me,#header a.me img{border-radius:30px;height:30px;overflow:hidden;width:30px}#header a.me{position:absolute;right:10px;top:10px}.pagination{border-bottom:1px solid #ddd;border-top:1px solid #fff;line-height:20px;overflow:hidden;padding:20px 0;position:relative;width:100%}.pagination .next,.pagination .prev{max-width:45%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.pagination .prev{float:left}.pagination .next{float:right}.pagination .center{margin:auto;text-align:center;width:80px}article{border-bottom:1px solid #ddd;border-top:1px solid #fff;padding:30px 0;position:relative;word-wrap:break-word}article .meta{color:#555;float:right;font-size:.9em;line-height:2;position:relative;text-align:right;width:auto}article .meta a{color:#999}article .meta .comment,article .meta .date,article .meta .tags{position:relative}article h1.title{color:#333;font-size:2em;font-weight:300;line-height:35px;margin-bottom:25px}article h1.title a{color:#333}article h1.title a:hover{color:#2479cc;transition:color .3s}article strong{font-weight:700}article em{font-style:italic}article blockquote{background-color:#f8f8f8;border-left:5px solid #2479cc;margin:10px 0 0;padding:15px 20px}article blockquote p{margin-bottom:0}article blockquote a{word-break:break-all;word-wrap:break-word}article code{background-color:#f2f2f2;border-radius:5px;font-family:Consolas,Courier New,Courier,mono,serif;font-size:80%;margin:0 2px;padding:4px 5px;vertical-align:middle}article pre{border-left:5px solid #ccc;color:#5d6a6a;font-family:Consolas,Liberation Mono,Courier,monospace;font-size:14px;line-height:1.6;padding:.6em;word-break:break-all;word-wrap:break-word;overflow:hidden;position:relative;white-space:pre-wrap}article pre code{background-color:transparent;border:0;border-radius:0;display:block;font-size:100%;margin:0;padding:0;position:relative}article pre b.name{color:#eee;font-size:60px;line-height:1;pointer-events:none;position:absolute;right:10px;top:10px}@media screen and (max-width:768px){article pre b.name{font-size:30px}}article img{border:1px solid #ccc;display:block;margin:10px 0 5px;max-width:100%;padding:0}article table{border:0;border-collapse:collapse;border-spacing:0}article table td,article table th{border:0}article table th{border-bottom:2px solid #848484;padding:6px 20px;text-align:left}article table td{border-bottom:1px solid #d0d0d0;padding:6px 20px}article .expire-tips{background-color:#ffffc0;border:1px solid #e2e2e2;border-left:5px solid #fff000;color:#333;font-size:15px;padding:5px 10px}article .aliyun-tips{background-color:#f0f8f4;border:1px solid #e2e2e2;border-left:5px solid #7cc4a0;font-size:15px;padding:5px 10px}article .post-info{font-size:14px}article .entry-content{font-size:16px;line-height:1.8;word-wrap:break-word}article .entry-content .date{color:#999;font-size:14px;font-style:italic}article .entry-content blockquote,article .entry-content dl,article .entry-content h1,article .entry-content h2,article .entry-content h3,article .entry-content h4,article .entry-content h5,article .entry-content h6,article .entry-content iframe,article .entry-content ol,article .entry-content p,article .entry-content pre,article .entry-content table,article .entry-content ul{margin-top:15px}article .entry-content blockquote>p:first-of-type,article .entry-content dl dl,article .entry-content dl ol,article .entry-content dl ul,article .entry-content ol dl,article .entry-content ol ol,article .entry-content ol ul,article .entry-content ul dl,article .entry-content ul ol,article .entry-content ul ul{margin-top:0}article .entry-content dl,article .entry-content ol,article .entry-content ul{margin-left:25px}article.tags section a{border:1px solid rgba(36,121,204,.8);border-radius:4px;color:#2479cccc;display:inline-block;font-size:14px;height:40px;line-height:40px;margin:0 15px 10px 0;padding:0 15px;text-decoration:none;transition:color .2s cubic-bezier(.4,.01,.165,.99),border .2s cubic-bezier(.4,.01,.165,.99)}article.tags section a:hover{border-color:#2479cc;color:#2479cc}a.anchor{display:block;position:relative;visibility:hidden}article .firekylin-code>ul{background-color:#fff;list-style:decimal;margin:0 0 0 40px;padding:0}article .firekylin-code li{border-left:1px solid #ddd;list-style:decimal-leading-zero;padding-left:2px;position:relative}article .firekylin-code li.mark{background-color:#fffbdd!important}article .firekylin-code li:hover{background-color:#f3f3f3!important}article .firekylin-code .line-num{cursor:pointer;height:100%;left:-40px;position:absolute;top:0;width:40px}article .firekylin-code li:nth-of-type(2n){background-color:#fcfcfc;color:inherit}article .entry-content pre .firekylin-code{background-color:#eee}#search .wrapper{margin-right:72px}#search form{position:relative}#search .wrapper input{box-sizing:border-box;padding:4px 6px;width:100%}#search .submit,#search .wrapper input{-webkit-appearance:none;border:1px solid #bbb;border-radius:0;display:block;font-size:16px;height:40px;outline:0}#search .submit{background-color:#e7e7e7;border-left:0;color:#222;position:absolute;right:0;top:0;width:72px}#searchResult{min-height:350px;overflow-x:hidden}#searchResult .info{border-bottom:1px solid #e9e9e9;color:#676767;font-size:13px;padding:15px 0}#searchResult .no-result{background-color:#fff4c2;border:1px solid #fc3;font-size:13px;margin:15px 0;padding:5px}#searchResult .hot-words,#searchResult .loading{margin-top:20px}#searchResult .hot-words a{margin-right:20px}#searchResult .item{padding:.5em 0 .3em}#searchResult .item .title a{font-size:16px;text-decoration:underline}#searchResult .item .title .type{background-color:#eee;border-radius:3px;color:#888;display:inline-block;font-size:13px;margin-right:8px;padding:0 5px}#searchResult .item .desc{font-size:14px;line-height:1.6}#searchResult .item .tags{font-size:14px;line-height:1.8}#searchResult .item .tags a{color:#666;margin-right:12px}#searchResult .item .desc b,#searchResult .item .title b{color:#c00;font-weight:400}#footer{border-top:1px solid #fff;font-size:.9em;line-height:1.8;padding:15px;text-align:center}#footer .beian{color:#666}#comments{border-bottom:1px solid #ddd;border-top:1px solid #fff;min-height:350px;padding:30px 0}#comments h1.title{font-size:25px;font-weight:300;line-height:35px;margin-bottom:20px}@media screen and (max-width:768px){#header{display:block;transform:translateZ(0);transition:all .2s cubic-bezier(.4,.01,.165,.99)}a.anchor{top:-50px}#sidebar.behavior_1{transform:translate3D(-250px,0,0)}#sidebar.behavior_2{transform:translateZ(0)}#sidebar{transition:transform .2s cubic-bezier(.4,.01,.165,.99)}#sidebar .profile{padding-bottom:20px;padding-top:20px}#sidebar .profile a,#sidebar .profile img{border-radius:100px;height:100px;width:100px}#sidebar .profile span{display:none}}@media screen and (min-width:769px)and (max-width:1024px){#sidebar{width:75px}#sidebar .profile{padding-top:20px}#sidebar .profile a,#sidebar .profile img{border-radius:40px;height:40px;width:40px}#sidebar .profile span{display:none}#sidebar .buttons li a{padding:0}#sidebar .buttons li a.inline{width:100%}#sidebar .buttons li a i{display:block;font-size:18px;margin:0 auto}#sidebar .buttons li a span{display:none}}@media screen and (min-width:768px)and (max-width:1024px){#main{padding-left:115px}}@media screen and (max-width:769px){#main{min-height:100%;padding-left:10px;padding-right:10px;padding-top:50px;width:100%}article{background-color:#fff;padding:10px}article .meta{display:none}article h1{font-size:22px;margin:0;padding:5px 0 10px}article .desc{color:#999;font-size:14px}article p.more{font-size:14px;margin:5px 0}}</style>
<style>.error-page{align-items:center;background:#f7f8fb;color:#47494e;display:flex;flex-direction:column;font-family:sans-serif;font-weight:100!important;justify-content:center;inset:0;padding:1rem;position:fixed;text-align:center;z-index:9999;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased}.error-page .error{max-width:450px}.error-page .title{color:#47494e;font-size:1.5rem;margin-bottom:8px;margin-top:15px}.error-page .description{color:#7f828b;line-height:21px;margin-bottom:10px}.error-page a{color:#7f828b!important;text-decoration:none}.error-page .clear-btn{background:#47494e;border:none;border-radius:4px;color:#fff;cursor:pointer;margin-top:20px;padding:10px 20px}.error-page .clear-btn:hover{background:#5a5c61}</style>
<style>#__nuxt,.wrapper{height:100%;width:100%}.main{height:100%}.main>article,.main>div,.main>section{border-bottom:0;margin-bottom:-81px;min-height:100%}.main>article:after,.main>div:after,.main>section:after{content:"";display:block;height:81px}.main>#footer{border-top:0;position:relative;z-index:1}</style>
<link rel="stylesheet" href="/_nuxt/style.CrTe0RXR.css" crossorigin>
<link rel="preload" as="fetch" crossorigin="anonymous" href="/post/build-your-first-thing-with-web-assembly/_payload.json?df94c4f4-124d-47f8-ad3f-fab4e4de2bbe">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/Du-K4N_a.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/B3NVNVF9.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/CD8Kvu7J.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/CaNb7KN_.js">
<script type="module" src="/_nuxt/Du-K4N_a.js" crossorigin></script>
<link rel="shortcut icon" href="/favicon.ico">
<meta name="description" content="WebAssembly  初尝">
<meta name="keywords" content="翻译,WebAssembly,JavaScript"></head><body><div id="__nuxt"><div class="wrapper"><nav id="sidebar" class="behavior_1"><div class="wrap"><div class="profile"><a href="/" class=""><img src="/imgs/avatar.jpg" alt="文蔺的博客"></a><span>文蔺的博客</span></div><ul class="buttons"><!--[--><li><a href="/" class="" title="主页"><i class="iconfont icon-home"></i><span> 主页</span></a></li><li><a href="/archives" class="" title="归档"><i class="iconfont icon-archive"></i><span> 归档</span></a></li><li><a href="/slides" class="" title="Slides"><i class="iconfont icon-archive"></i><span> Slides</span></a></li><li><a href="/about" class="" title="关于"><i class="iconfont icon-user"></i><span> 关于</span></a></li><li><a href="/link" class="" title="关注"><i class="iconfont icon-link"></i><span> 关注</span></a></li><li><a href="/collection" class="" title="收藏"><i class="iconfont icon-archive"></i><span> 收藏</span></a></li><!--]--></ul></div><ul class="buttons"><li><a href="https://github.com/AngusFu/" class="inline" rel="nofollow" target="_blank"><i class="iconfont icon-github-v" title="GitHub"></i></a><!----><!----><a class="inline" href="/atom.xml" target="_blank"><i class="iconfont icon-rss-v" title="RSS"></i></a><a href="/search" class="inline"><i class="iconfont icon-search" title="Search"></i></a></li></ul></nav><div id="header"><div class="btn-bar"><i></i></div><h1><a href="/" class="">文蔺的博客</a></h1><a href="/about/" class="me"><img src="/imgs/avatar.jpg" alt="文蔺的博客"></a></div><div id="sidebar-mask" style="display:none;"></div><div id="main" class="main"><!--[--><div id="page-post"><article class="post detail"><div class="meta"><div class="date">2016-08-16</div></div><h1 class="title">[译] WebAssembly  初尝</h1><div class="entry-content"><blockquote><p style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;"> 原文作者: <a target="_blank" href="https://twitter.com/fody">@Nick Larsen</a><br>原文地址: <a target="_blank" href="http://cultureofdevelopment.com/blog/build-your-first-thing-with-web-assembly">http://cultureofdevelopment.com/blog/build-your-first-thing-with-web-assembly</a><br>译文地址: <a target="_blank" href="https://www.wemlion.com/post/build-your-first-thing-with-web-assembly">https://www.wemlion.com/post/build-your-first-thing-with-web-assembly</a><br>本文由 <a target="_blank" href="https://www.wemlion.com">文蔺</a> 翻译，转载请保留此声明。 <br>著作权属于原作者，本译文仅用于学习、研究和交流目的，请勿用于商业目的。 </p></blockquote><!--[--><p>头一次听说 <a href="https://webassembly.github.io/" target="_blank" rel="noopener">WebAssembly</a> 的时候就觉得很酷，然后就超兴奋地开始尝试。但从一开始尝试的过程就不顺利，越来越让人灰心。本文的目的就是解决问题，让你免受困扰。</p><p><img loading="lazy" src="https://p3.ssl.qhimg.com/t014315b7ee6ed04cb7.jpg" alt="beware of cliff"></p><h3>读者须知</h3><p>本文写作于 2016 年 6 月 24 日。WebAssembly 是一项很新的、不稳定的技术；随着其标准化过程发展，本文中的任何内容都可能是错误的。</p><p>不过先不管了....</p><h3>WebAssembly 是什么</h3><p>好吧，官网是这么描述的：</p><blockquote><p>WebAssembly，或者称作 wasm，是一项适用于 Web 编译的可移植的、体积与加载高效的格式。（WebAssembly or wasm is a new portable, size- and load-time-efficient format suitable for compilation to the web.）</p></blockquote><p>嗯...什么鬼？什么格式？文本（Text）？二进制（Binary）？老实说，这个描述真糟糕。所以不管它，收起那些 binggo 游戏卡（buzzword bingo cards，一种填词游戏，这些词通常都是流行语，阅读<a href="https://en.wikipedia.org/wiki/Buzzword_bingo" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Buzzword_bingo</a>了解更多 —— 译者注），根据我所有的经验来描述吧：</p><blockquote><p>WebAssembly/wasm 是用来编写高性能的、浏览器无关的 Web 组件的一种字节码规范。（WebAssembly or wasm is a bytecode specification for writing performant, browser agnostic web components.）</p></blockquote><p>有此妙语，听起来超棒，但仍然没 get 到点，接下来重点来了。WebAssembly 通过静态类型变量实现性能提升，运行时静态类型变量引用比动态类型变量更有效率。WebAssembly 由 <a href="https://www.w3.org/community/webassembly/" target="_blank" rel="noopener">W3C Community Group</a> 制定，最终将被所有规范兼容的浏览器支持。还有杀手锏，<em>最终</em>我们可以使用<em>任何</em>语言编写这些 Web 组件（web components）。</p><p>听起来酷了很多，不是么？</p><h3>一起开始吧</h3><p>学习新东西的时候，我通常会找尽可能最简单的例子来看它是如何工作的。不幸的是，对 WebAssembly 来说，这不太现实。在当前阶段，wasm 仅仅只是字节码规范。想象回到 1996 年，假如太阳公司（Sun Microsystems）的一些工程师们带来了 JVM，但却...没有 Java....若果真如此，我想当时的对话可能是这样的：</p><p>—— “伙计们，快来看看我们做的这个执行字节码的虚拟机！” —— “真棒！但我们给它怎么写代码？”</p><p><img loading="lazy" src="https://p1.ssl.qhimg.com/t01c5889a9cdf0ef479.png" alt="HelloWorld.class"></p><p><em>图：字节码形式的 HelloWorld</em></p><p>—— “嗯..这问题提得好。等会儿我查查看。” —— “真棒，如果遇到了任何问题，告诉我们你的想法，在我们的 github page 上贴出来。” —— “你说对啦。我们现在先去看看其他项目。”</p><p>这个例子有些糟糕，因为 JVM 是基于 Java 语言的；尽管如此，希望你还是 get 到点了。如果都没有将代码编译为字节码的工具，要起步就很困难了。那我们要怎么开始？</p><h3>WebAssembly 之前有什么</h3><p>多数技术都是创新的结果，特别是当合理的尝试成为正式规范时。wasm 也不例外，它实际上是 <a href="http://asmjs.org/" target="_blank" rel="noopener">asm.js</a> 的工作的延续， asm.js 是一个编写 javascript 组件的的规范，可编译为静态类型。wasm 的规范拓展了这些创意，它接受任何语言编译而成的字节码，这些字节码作为二进制文件而非文本文件通过网络传输；规范由很多来自主流浏览器厂商的代表们一起制定，而非仅仅是 Mozilla。</p><p>asm.js 仅仅是一个使用 javascript 语言特征的最小子集编写 javascript 的规范。你可以手写一些简单的 asm.js 代码，如果你想弄脏你的手，这正是极好的方式。（等会儿最好将这放在单独的文件中，通常约定文件名格式为 <code>your-module-name.asm.js</code>。）)</p><pre><code class="hljs lang-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyMathModule</span>(<span class="hljs-params"><span class="hljs-variable language_">global</span></span>) {
    <span class="hljs-string">&quot;use asm&quot;</span>;
    <span class="hljs-keyword">var</span> exp = <span class="hljs-variable language_">global</span>.<span class="hljs-property">Math</span>.<span class="hljs-property">exp</span>;
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">doubleExp</span>(<span class="hljs-params">value</span>) {
        value = +value;
        <span class="hljs-keyword">return</span> +(+<span class="hljs-title function_">exp</span>(+value) * <span class="hljs-number">2.0</span>);
    }
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">doubleExp</span>: doubleExp };
}
</code></pre><p>这还不是一个特别有用的函数，但符合规范。如果你觉得这很二，别人也是这么觉得的，不过基本上每一个字符都是必须的。在这当中，一元运算符 <code>+</code> 的作用是类型注解，这样编译器会知道那些变量是 double 类型的，运行时就不必再次分辨它们是什么。它相当挑剔，如果你把什么地方弄得一团糟，火狐控制台会给你一些合理的错误信息。</p><p>如果你想在浏览器中使用，像下面这样：</p><pre><code class="hljs lang-javascript"><span class="hljs-keyword">var</span> myMath = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyMathModule</span>(<span class="hljs-variable language_">window</span>);
<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myMath.<span class="hljs-title function_">doubleExp</span>(i));
}
</code></pre><p>一切正常的话，结果大概像下图这样：</p><p><img loading="lazy" src="https://p3.ssl.qhimg.com/t01d27d8a53bcd3c767.png" alt="asm.js success"></p><h3>开始尝试 WebAssembly</h3><p>现在我们已经有了一个可以工作的 asm.js 代码片段，可以使用 <a href="https://github.com/WebAssembly/binaryen" target="_blank" rel="noopener">WebAssembly github page</a> 提供的工具将其编译为 wasm。自己克隆代码仓库构建工具吧。这最麻烦了。这些工具一直在不断发展，代码会时不时挂掉，特别是在 Windows 环境下。</p><p>不管你是用 Windows 还是 Mac，电脑上必须要安装 make 和 cmake 命令行工具。如果你在使用 Windows，你还需要安装 Visual Studio 2015。Mac 用户按照<a href="https://github.com/WebAssembly/binaryen#building" target="_blank" rel="noopener">这里的说明</a> 操作；Windows 用户按照<a href="https://github.com/brakmic/brakmic/blob/master/webassembly/COMPILING_WIN32.md" target="_blank" rel="noopener">这个说明</a>操作。</p><p><img loading="lazy" src="https://p3.ssl.qhimg.com/t01f65f188a46e3d538.png" alt="building binaryen"></p><p><em>图： Windows 下的工具构建</em></p><p>对 WebAssembly 团队来说，发布可以工作的二进制文件意味着朝着正确的方向前进了一大步。</p><p>构建成功之后，binaryen 目录下会有一个 bin 文件夹，其中有一些用来将 asm.js 转换为 wasm 的工具。第一个工具是 <code>asm2wasm.exe</code>。它将 asm.js 代码转换为 <code>.s</code> 格式的代码，这些代码是生成 wasm 所需的抽象语法树（AST）的文本表现形式。运行工具，最终会得到类似下面的东西：</p><pre><code>(module
  (memory 256 256)
  (export &quot;memory&quot; memory)
  (type $FUNCSIG$dd (func (param f64) (result f64)))
  (import $exp &quot;global.Math&quot; &quot;exp&quot; (param f64) (result f64))
  (export &quot;doubleExp&quot; $doubleExp)
  (func $doubleExp (param $0 f64) (result f64)
    (f64.mul
      (call_import $exp
        (get_local $0)
      )
      (f64.const 2)
    )
  )
)
</code></pre><p>以后我们可以逐行分析上面的代码，但现在我只想让你看下它的样子。我还得提醒你一点，因为 wasm 是二进制格式的，所以像你今天对 javascript 所做的那样右击、查看源码是行不通的。从头到尾都是二进制码。目前的计划是查看 wasm 模块源码时对二进制格式进行反汇编，让人能读懂。</p><p>接下来要做的是使用 <code>wasm-as.exe</code> 将 <code>.s</code> 格式的代码转换为 wasm 二进制码。运行文件，最后就能得到浏览器需要的真正的 wasm 二进制码。</p><p><img loading="lazy" src="http://cultureofdevelopment.com/img/binaryen-transform.png" alt="building wasm from asm.js"></p><p><em>图：将 asm.js 转换为 wasm 二进制码</em></p><p><img loading="lazy" src="https://p3.ssl.qhimg.com/t01a5965c1d53b30e20.png" alt="wasm bytecode"></p><p><em>图：wasm 二进制码</em></p><p>紧接着，安装最新版的 <a href="https://www.mozilla.org/en-US/firefox/new/" target="_blank" rel="noopener">Firefox</a> 或 <a href="https://www.google.com/chrome/browser/canary.html" target="_blank" rel="noopener">Chrome Canary</a>，并启用 WebAssembly。</p><p>如果你使用的是 Firefox，在地址栏中输入 <code>about:config</code>，点击“确认我会保证小心”。然后在搜索框中输入 <code>wasm</code>，双击 <code>javascript.options.wasm</code> 将值设置为 true，然后重启浏览器。</p><p>如果你使用的是 Chrome Canary，打开 <code>chrome://flags</code>，往下翻，找到 <code>Experimental WebAssembly</code>，点击“启用”链接，再重启浏览器。</p><p>最后一步就是让模块在浏览器中跑起来。初次尝试时，这又是一大痛点，完全不知道怎么做。在规范中使用 wasm 模块的 API 一点都没找到。最后我在 Canary 的控制台上输入 <code>WebAsse</code>，并没有任何提示。接着输入 <code>Was</code> 的时候，提示出来了！控制台上打印出的对象大概最简陋的文档了，不过这时候我突然想到，可以用一些其他工具 (emscripten) 将代码编译为 wasm。不过这是另外一篇博客的话题了。</p><p>一段时间之后，鼠标落在了 WebAssembly 的设计文档仓库上。我看到了一个名为 <a href="https://github.com/WebAssembly/design/blob/master/JS.md" target="_blank" rel="noopener">JS.md</a> 的文件，点击之后，有一个 API 的说明。仔细看顶部斜体的文字。但最精彩的部分还是最底部的代码片段，演示了如何最低限度地加载模块。我所需要做的就是拆出相关部分进行尝试。</p><pre><code class="hljs lang-javascript"><span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;my-math-module.wasm&quot;</span>)
    .<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) {
        <span class="hljs-keyword">return</span> response.<span class="hljs-title function_">arrayBuffer</span>();
    })
    .<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">buffer</span>) {
        <span class="hljs-keyword">var</span> dependencies = {
            <span class="hljs-string">&quot;global&quot;</span>: {},
            <span class="hljs-string">&quot;env&quot;</span>: {}
        };
        dependencies[<span class="hljs-string">&quot;global.Math&quot;</span>] = <span class="hljs-variable language_">window</span>.<span class="hljs-property">Math</span>;
        <span class="hljs-keyword">var</span> moduleBufferView = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer);
        <span class="hljs-keyword">var</span> myMathModule = <span class="hljs-title class_">Wasm</span>.<span class="hljs-title function_">instantiateModule</span>(moduleBufferView, dependencies);
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myMathModule.<span class="hljs-property">exports</span>.<span class="hljs-property">doubleExp</span>);
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myMathModule.<span class="hljs-property">exports</span>.<span class="hljs-title function_">doubleExp</span>(i));
        }
    });
</code></pre><p>把代码放到 html 文件中，<a href="https://www.npmjs.com/package/local-web-server" target="_blank" rel="noopener">启动本地文件服务器</a>，在浏览器中加载页面。下面是在浏览器中的结果：</p><p><img loading="lazy" src="https://p3.ssl.qhimg.com/t01631e5f7d290aae84.png" alt="wasm in a browser"></p><p>*浏览器中运行的 wasm （至少尝试运行了） *</p><p>我估计需要去提交一个 bug 报告了。记着，一切都是实验性的、不稳定的，所以当此类事情发生的时候，别灰心丧气。</p><p><img loading="lazy" src="https://p3.ssl.qhimg.com/t017618b22a564ebf7f.png" alt="keep calm and file bug reports"></p><h3>恭喜你</h3><p>你已经完成了第一个 WebAssembly 组件。接下来做些什么？目前我们碰到的还只是皮毛而已。在本例中手写 asm.js 很重要，但需要时间和耐心。使用 emscripten 将应用转换为 asm.js 要简单多了。关于这一点，我强烈建议你阅读 asm.js 规范，特别是内存模型的部分，因为其中的许多概念都被迁移到 WebAssembly 上了。另外一个怪异的事情是，目前还不能直接将数组作为函数参数。人们已经达成共识，这需要改变，但规范中尚未有关于这一点的。去看看指针逻辑吧。</p><p>还有一点，在 wasm 中做一些工作的时候，你可能发展实际上 WebAssembly 还没普通的 javascript 运行得快。记住，现代的 javascript 引擎已经是高度优化的，wasm 要赶上这速度还需要时间。WebAssembly 还尚未进入准备生产的阶段。</p><p>如果你有任何关于 wasm 或者本文中提到的工具的问题，在 <a href="http://stackoverflow.com" target="_blank" rel="noopener">Stack Overflow</a> 中提出来，记得标上恰当的 tag。</p><!--]--></div></article><nav class="pagination"><a href="/post/offline-storage-for-progressive-web-apps" class="prev" title="[译] 渐进式 Web App 的离线存储">« [译] 渐进式 Web App 的离线存储</a><a href="/post/set-up-automated-cross-browser-javascript-unit-testing" class="next" title="[译] 自动化、跨浏览器的 JavaScript 单元测试">[译] 自动化、跨浏览器的 JavaScript 单元测试 »</a></nav></div><!--]--><footer id="footer" class="inner"> © 2026 -  文蔺的博客 <span> - </span><a href="/" class="">www.wemlion.com</a><br> Powered by <a target="_blank" href="https://nuxt.com">Nuxt 3</a> &amp; <a target="_blank" rel="nofollow" class="external" href="https://firekylin.org">FireKylin</a></footer></div></div></div><div id="teleports"></div><script>window.__NUXT__={};window.__NUXT__.config={public:{title:"文蔺的博客",description:"文蔺的前端学习记录，国外技术文章翻译，个人学习心得等等这些都会记录在这里。",favicon:"/img/favicon.ico",site_owner:"文蔺",hostname:"www.wemlion.com",github_url:"https://github.com/AngusFu/",logo_url:"/imgs/avatar.jpg",navigation:[{url:"/",option:"home",label:"主页"},{url:"/archives",option:"archive",label:"归档"},{url:"/slides",option:"archive",label:"Slides"},{url:"/about",option:"user",label:"关于"},{url:"/link",option:"link",label:"关注"},{url:"/collection",option:"archive",label:"收藏"}],page_size:10,site_url:"https://www.wemlion.com"},app:{baseURL:"/",buildId:"df94c4f4-124d-47f8-ad3f-fab4e4de2bbe",buildAssetsDir:"/_nuxt/",cdnURL:""}}</script>
<script type="application/json" data-nuxt-data="nuxt-app" data-ssr="true" id="__NUXT_DATA__" data-src="/post/build-your-first-thing-with-web-assembly/_payload.json?df94c4f4-124d-47f8-ad3f-fab4e4de2bbe">[{"state":1,"once":3,"_errors":4,"serverRendered":6,"path":7,"prerenderedAt":8},["Reactive",2],{},["Set"],["ShallowReactive",5],{},true,"/post/build-your-first-thing-with-web-assembly",1769607813980]</script></body></html>