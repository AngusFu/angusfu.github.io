import{_ as p}from"./Bm2Oy-cY.js";import{c as t,w as c,o,a as s,b as l}from"./YobvFIQM.js";const d={__name:"eleven-npm-tricks-that-will-knock-your-wombat-socks-off",setup(r){const a={title:"[译] 让人倾倒的 11 个 npm trick",keywords:"翻译,Node.js,npm",pathname:"eleven-npm-tricks-that-will-knock-your-wombat-socks-off",translation:{author:"@Tierney Coren",social:"https://twitter.com/bitandbang",from:"https://nodesource.com/blog/eleven-npm-tricks-that-will-knock-your-wombat-socks-off/"},create_time:"2016-09-03",prev:{title:"笔记：TypeScript 中引用全局变量",pathname:"ts-note-on-global-reference"},next:{title:"[译] HTTP 推送",pathname:"being-pushy"}};return(i,n)=>{const e=p;return o(),t(e,{data:a},{default:c(()=>[...n[0]||(n[0]=[s("p",null,[s("img",{loading:"lazy",src:"https://p3.ssl.qhimg.com/t014d6a103b20214141.png",alt:"让人倾倒的 11 个 npm trick"})],-1),s("p",null,"有效率地使用 npm 可能会很困难。内置特性堆积如山，尝试学习它们是很艰巨的任务。",-1),s("p",null,[l("就我个人而言，单学习并使用其中一些小 trick 解救了我，从前移除那些未使用的模块时，我只能先删除整个 "),s("code",null,"node_modules"),l(" 文件夹，接着再用 "),s("code",null,"npm install"),l(" 重新安装"),s("em",null,"一切"),l("。（"),s("code",null,"npm prune"),l("，请见本文第四节。）如你所想，这简直要让人发狂了。")],-1),s("p",null,"我们编了这样一个 trick 列表，使用起来很简单，它们会加速你使用 npm 开发的过程，无论你在做什么项目。",-1),s("h2",null,"1.打开 package 主页",-1),s("p",null,[s("strong",null,"运行:"),l(),s("code",null,"npm home $package")],-1),s("p",null,[l("执行 "),s("code",null,"home"),l(" 命令会打开 "),s("code",null,"$package"),l(" 的主页。例如，如果指定 "),s("code",null,"$package"),l(" 为 "),s("code",null,"lodash"),l("，那么就就会打开 Lodash 官网。没有安装（全局/某个项目） package 不影响该命令的使用。")],-1),s("h2",null,"2. 打开 package Github 仓库",-1),s("p",null,[s("strong",null,"运行:"),l(),s("code",null,"npm repo $package")],-1),s("p",null,[l("类似前面的 "),s("code",null,"home"),l(" 命令， "),s("code",null,"repo"),l(" 命令会打开 "),s("code",null,"$package"),l(" 的 Github 仓库。如 "),s("code",null,"npm repo express"),l(" 会打开 Express 的官方仓库地址。同样，不需要安装 package 就能使用。")],-1),s("h2",null,"3. 检查 package 的过时依赖",-1),s("p",null,[s("strong",null,"运行:"),l(),s("code",null,"npm outdated")],-1),s("p",null,[l("在项目中，运行 "),s("code",null,"outdated"),l(" 命令会通过 npm registry 检查是否有过时的 package，并在命令行中打印出当前版本、所需版本以及最新版本。")],-1),s("p",null,[s("img",{loading:"lazy",src:"https://p3.ssl.qhimg.com/t01be55669dcc86377b.png",alt:"在 Node 项目中运行 npm outdated"})],-1),s("h2",null,"4. 检查 package.json 中未声明的 package",-1),s("p",null,[s("strong",null,"运行:"),l(),s("code",null,"npm prune")],-1),s("p",null,[l("运行 "),s("code",null,"prune"),l(" 命令，npm CLI 会读取 "),s("code",null,"package.json"),l("，并将结果与项目的 "),s("code",null,"/node_modules"),l(" 目录进行对比，并打印出不在 "),s("code",null,"package.json"),l(" 之列的模块列表。")],-1),s("p",null,[s("code",null,"npm prune"),l(" 命令接着会拿出这些 package，并移除那些没有手动加到 "),s("code",null,"package.json"),l(" 中或没有使用 "),s("code",null,"--save"),l(" 标志安装的 package。")],-1),s("p",null,[s("img",{loading:"lazy",src:"https://p0.ssl.qhimg.com/t01d021722c08048520.png",alt:"在 Node 项目中运行 npm prune"})],-1),s("p",null,[s("strong",null,"更新："),l(" 感谢 "),s("a",{href:"https://twitter.com/EvanHahn",target:"_blank",rel:"noopener"},"@EvanHahn"),l(" 提醒，一种个人配置可以让 "),s("code",null,"npm prune"),l(" 提供与 "),s("code",null,"npm"),l(" 默认方式略有不同的结果。")],-1),s("h2",null,"5. 锁定依赖版本",-1),s("p",null,[s("strong",null,"运行:"),l(),s("code",null,"npm shrinkwrap")],-1),s("p",null,[l("在项目中使用 "),s("code",null,"shrinkwrap"),l(" 命令，会生成一个 "),s("code",null,"npm-shrinkwrap.json"),l(" 文件，将项目依赖锁定在当前在 "),s("code",null,"node_modules"),l(" 中使用的特定版本。运行 "),s("code",null,"npm install"),l(" 时，若发现存在 "),s("code",null,"npm-shrinkwrap.json"),l("，则会覆盖列出的依赖以及 "),s("code",null,"package.json"),l(" 中的任何语义版本范围。")],-1),s("p",null,[l("如果需要验证项目中 "),s("code",null,"package.json"),l("、 "),s("code",null,"npm-shrinkwrap.json"),l(" 及 "),s("code",null,"node_modules"),l(" 的一致性，可以考虑使用 "),s("a",{href:"https://github.com/uber/npm-shrinkwrap",target:"_blank",rel:"noopener"},"npm-shrinkwrap"),l("。")],-1),s("p",null,[s("img",{loading:"lazy",src:"https://p2.ssl.qhimg.com/t010ecff8dd4bc1fe35.png",alt:"在 Node 项目中运行 npm shrinkwrap"})],-1),s("h2",null,"6. 在 Node.js v4 LTS 中使用 npm v3",-1),s("p",null,[s("strong",null,"运行:"),l(),s("code",null,"npm install -g npm@3")],-1),s("p",null,[l("使用 npm 全局安装 "),s("code",null,"npm@3"),l("，会将 npm v2 升级至 v3。使用 npm v2 LTS 的 Node.js v4 LTS 发布版本（“Argon”）中也是如此。这会在 v4 LTS 中安装 npm v3 的最新稳定版本。（译者注：LTS 指 Long-Term Support， 即提供长期技术支持的版本。）")],-1),s("h2",null,[l("7. 运行 "),s("code",null,"npm install -g"),l("，无需加 "),s("code",null,"sudo")],-1),s("p",null,[s("strong",null,"运行:"),l(),s("code",null,"npm config set prefix $dir")],-1),s("p",null,[s("code",null,"$dir"),l(" 指你想将"),s("em",null,"全局依赖安装在的"),l("目录，运行命令，这一来，安装全局模块再也不用使用 sudo，该目录则成为全局的 bin 目录。唯一需要注意的是，确保使用 "),s("code",null,"chown -R $USER $dir"),l(" 该目录的"),s("strong",null,"调整用户权限"),l("。")],-1),s("h2",null,"8. 改变所有项目的默认前缀",-1),s("p",null,[s("strong",null,"运行:"),l(),s("code",null,"npm config set save-prefix ~")],-1),s("p",null,[l("使用 "),s("code",null,"--save"),l(" 或 "),s("code",null,"--save-dev"),l(" 标志安装新 package 时，使用 "),s("code",null,"~"),l(" 比默认的 "),s("code",null,"^"),l(" 行为更加保守。"),s("code",null,"~"),l(" 将依赖锁定在小版本（minor version），允许使用 "),s("code",null,"npm update"),l(" 安装补丁版本。"),s("code",null,"^"),l(" 将依赖锁定在主版本，允许使用 "),s("code",null,"npm update"),l("更新小版本。")],-1),s("h2",null,[l("9. 生产环境下去除 "),s("code",null,"devDependencies"),l(" 依赖")],-1),s("p",null,[l("项目准备上到生产环境时，确保使用 "),s("code",null,"--production"),l(" 标志安装依赖。该标志会安装 "),s("code",null,"dependencies"),l("，忽略 "),s("code",null,"devDependencies"),l("。这会确保开发所使用的工具及 package 不会进入生产环境。")],-1),s("p",null,[l("此外，还可以将 "),s("code",null,"NODE_ENV"),l(" 环境变量设置为 "),s("code",null,"production"),l("，确保 "),s("code",null,"devDependencies"),l(" 绝不会被安装。")],-1),s("h2",null,[l("10. 使用 "),s("code",null,".npmignore"),l(" 要当心")],-1),s("p",null,[l("如果还没使用过 "),s("code",null,".npmignore"),l("，会默认使用 "),s("code",null,".gitignore"),l(" 文件，加上一些更健全的默认选项。")],-1),s("p",null,[l("很多人不明白都是，一旦在项目中添加了 "),s("code",null,".npmignore"),l(" 文件，"),s("code",null,".gitignore"),l(" 的规则就会被忽略（好讽刺，出乎意料啊）。结果就是，发布项目时，不得不审查两个文件是否同步，防止敏感信息的泄露。")],-1),s("h2",null,[l("11. 带默认内容的 "),s("code",null,"npm init")],-1),s("p",null,[l("在新项目中运行 "),s("code",null,"npm init"),l(" 时，可以配置 "),s("code",null,"package.json"),l(" 细节。如果想设置 "),s("code",null,"npm init"),l(" 会一直使用的默认工作，可以使用 "),s("code",null,"config set"),l(" 命令，加上一些额外的参数：")],-1),s("pre",null,[s("code",{class:"hljs lang-bash"},[l("npm config "),s("span",{class:"hljs-built_in"},"set"),l(" init.author.name "),s("span",{class:"hljs-variable"},"$name"),l(`
npm config `),s("span",{class:"hljs-built_in"},"set"),l(" init.author.email "),s("span",{class:"hljs-variable"},"$email"),l(`
`)])],-1),s("p",null,"若想彻底自定义初始化脚本，可以指定一个自定义的默认脚本：",-1),s("pre",null,[s("code",{class:"hljs lang-bash"},[l("npm config "),s("span",{class:"hljs-built_in"},"set"),l(` init-module ~/.npm-init.js
`)])],-1),s("p",null,[l("下面是一个示例脚本，会弹出私有设置项，在需要情况下创建 Github 仓库。确保更改默认的 Github 用户名（"),s("code",null,"YOUR_GITHUB_USERNAME"),l("），作为 Github 用户名环境变量的 fallback 值。")],-1),s("pre",null,[s("code",{class:"hljs lang-javascript"},[s("span",{class:"hljs-keyword"},"var"),l(" cp = "),s("span",{class:"hljs-built_in"},"require"),l("("),s("span",{class:"hljs-string"},"'child_process'"),l(`);
`),s("span",{class:"hljs-keyword"},"var"),l(` priv;

`),s("span",{class:"hljs-keyword"},"var"),l(),s("span",{class:"hljs-variable constant_"},"USER"),l(" = process."),s("span",{class:"hljs-property"},"env"),l("."),s("span",{class:"hljs-property"},"GITHUB_USERNAME"),l(" || "),s("span",{class:"hljs-string"},"'YOUR_GITHUB_USERNAME'"),l(`;

`),s("span",{class:"hljs-variable language_"},"module"),l("."),s("span",{class:"hljs-property"},"exports"),l(` = {

  `),s("span",{class:"hljs-attr"},"name"),l(": "),s("span",{class:"hljs-title function_"},"prompt"),l("("),s("span",{class:"hljs-string"},"'name'"),l(", basename || package."),s("span",{class:"hljs-property"},"name"),l(`),

  `),s("span",{class:"hljs-attr"},"version"),l(": "),s("span",{class:"hljs-string"},"'0.0.1'"),l(`,

  `),s("span",{class:"hljs-attr"},"private"),l(": "),s("span",{class:"hljs-title function_"},"prompt"),l("("),s("span",{class:"hljs-string"},"'private'"),l(", "),s("span",{class:"hljs-string"},"'true'"),l(", "),s("span",{class:"hljs-keyword"},"function"),l("("),s("span",{class:"hljs-params"},"val"),l(`){
    `),s("span",{class:"hljs-keyword"},"return"),l(" priv = ("),s("span",{class:"hljs-keyword"},"typeof"),l(" val === "),s("span",{class:"hljs-string"},"'boolean'"),l(") ? val : !!val."),s("span",{class:"hljs-title function_"},"match"),l("("),s("span",{class:"hljs-string"},"'true'"),l(`)
  }),

  `),s("span",{class:"hljs-attr"},"create"),l(": "),s("span",{class:"hljs-title function_"},"prompt"),l("("),s("span",{class:"hljs-string"},"'create github repo'"),l(", "),s("span",{class:"hljs-string"},"'yes'"),l(", "),s("span",{class:"hljs-keyword"},"function"),l("("),s("span",{class:"hljs-params"},"val"),l(`){
    val = val.`),s("span",{class:"hljs-title function_"},"indexOf"),l("("),s("span",{class:"hljs-string"},"'y'"),l(") !== -"),s("span",{class:"hljs-number"},"1"),l(" ? "),s("span",{class:"hljs-literal"},"true"),l(" : "),s("span",{class:"hljs-literal"},"false"),l(`;

    `),s("span",{class:"hljs-keyword"},"if"),l(`(val){
      `),s("span",{class:"hljs-variable language_"},"console"),l("."),s("span",{class:"hljs-title function_"},"log"),l("("),s("span",{class:"hljs-string"},"'enter github password:'"),l(`);
      cp.`),s("span",{class:"hljs-title function_"},"execSync"),l("("),s("span",{class:"hljs-string"},`"curl -u '"`),l("+"),s("span",{class:"hljs-variable constant_"},"USER"),l("+"),s("span",{class:"hljs-string"},`"' https://api.github.com/user/repos -d "`),l(` +
        `),s("span",{class:"hljs-string"},`"'{\\"name\\": \\""`),l("+basename+"),s("span",{class:"hljs-string"},'"\\", \\"private\\": "'),l("+ ((priv) ? "),s("span",{class:"hljs-string"},"'true'"),l(" : "),s("span",{class:"hljs-string"},"'false'"),l(")  +"),s("span",{class:"hljs-string"},`"}' "`),l(`);
      cp.`),s("span",{class:"hljs-title function_"},"execSync"),l("("),s("span",{class:"hljs-string"},"'git remote add origin '"),l("+ "),s("span",{class:"hljs-string"},"'https://github.com/'"),l("+"),s("span",{class:"hljs-variable constant_"},"USER"),l("+"),s("span",{class:"hljs-string"},"'/'"),l(" + basename + "),s("span",{class:"hljs-string"},"'.git'"),l(`);
    }

    `),s("span",{class:"hljs-keyword"},"return"),l(),s("span",{class:"hljs-literal"},"undefined"),l(`;
  }),

  `),s("span",{class:"hljs-attr"},"main"),l(": "),s("span",{class:"hljs-title function_"},"prompt"),l("("),s("span",{class:"hljs-string"},"'entry point'"),l(", "),s("span",{class:"hljs-string"},"'index.js'"),l(`),

  `),s("span",{class:"hljs-attr"},"repository"),l(`: {
    `),s("span",{class:"hljs-attr"},"type"),l(": "),s("span",{class:"hljs-string"},"'git'"),l(`,
    `),s("span",{class:"hljs-attr"},"url"),l(": "),s("span",{class:"hljs-string"},"'git://github.com/'"),l("+"),s("span",{class:"hljs-variable constant_"},"USER"),l("+"),s("span",{class:"hljs-string"},"'/'"),l(" + basename + "),s("span",{class:"hljs-string"},"'.git'"),l(` },

  `),s("span",{class:"hljs-attr"},"bugs"),l(": { "),s("span",{class:"hljs-attr"},"url"),l(": "),s("span",{class:"hljs-string"},"'https://github.com/'"),l("+"),s("span",{class:"hljs-variable constant_"},"USER"),s("span",{class:"hljs-string"},"'/'"),l(" + basename + "),s("span",{class:"hljs-string"},"'/issues'"),l(` },

  `),s("span",{class:"hljs-attr"},"homepage"),l(": "),s("span",{class:"hljs-string"},'"https://github.com/"'),l("+"),s("span",{class:"hljs-variable constant_"},"USER"),l("+"),s("span",{class:"hljs-string"},'"/"'),l(` + basename,

  `),s("span",{class:"hljs-attr"},"keywords"),l(": "),s("span",{class:"hljs-title function_"},"prompt"),l("("),s("span",{class:"hljs-keyword"},"function"),l(" ("),s("span",{class:"hljs-params"},"s"),l(") { "),s("span",{class:"hljs-keyword"},"return"),l(" s."),s("span",{class:"hljs-title function_"},"split"),l("("),s("span",{class:"hljs-regexp"},"/\\s+/"),l(`) }),

  `),s("span",{class:"hljs-attr"},"license"),l(": "),s("span",{class:"hljs-string"},"'MIT'"),l(`,

  `),s("span",{class:"hljs-attr"},"cleanup"),l(": "),s("span",{class:"hljs-keyword"},"function"),l("("),s("span",{class:"hljs-params"},"cb"),l(`){

    `),s("span",{class:"hljs-title function_"},"cb"),l("("),s("span",{class:"hljs-literal"},"null"),l(", "),s("span",{class:"hljs-literal"},"undefined"),l(`)
  }

}
`)])],-1),s("h2",null,"最后一点...",-1),s("p",null,[l("若想学习更多关于 npm、Node.js、JavaScript、Docker、Kubernetes 以及 Electron 等等等等，可以在 Twitter、 上关注 "),s("a",{href:"https://twitter.com/nodesource",target:"_blank",rel:"noopener"},"@NodeSource"),l("。我们一直都在，很乐意收到你的消息！")],-1)])]),_:1})}}};export{d as default};
