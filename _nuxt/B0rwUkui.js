import{_ as l}from"./CaNb7KN_.js";import{c as n,w as o,o as c,a as e,b as s}from"./Du-K4N_a.js";const g={__name:"backdoor-service-worker",setup(p){const r={title:"[译] 给 Service Worker 开后门",description:"给 Service Worker 开后门",keywords:"翻译,Service Worker",pathname:"backdoor-service-worker",translation:{author:"@Jeremy Keith",social:"https://medium.com/@adactio/",from:"https://medium.com/@adactio/backdoor-service-workers-86d241d79996#.bfuq4cdih"},create_time:"2016-07-13",prev:{title:"[译] Hybrid or Native： 适合工作的才是最好的",pathname:"hybrid-or-native-mobile-app-use-the-right-tool-for-the-job"},next:{title:"Node.js .sh scripts Manager",pathname:"Node.js-sh-scripts-Manager"}};return(i,a)=>{const t=l;return c(),n(t,{data:r},{default:o(()=>[...a[0]||(a[0]=[e("p",null,[s("在"),e("a",{href:"https://adactio.com/journal/10866",target:"_blank",rel:"noopener"},"渐进式 Web App 开发峰会(Progressive Web App dev Summit)"),s("上展示的时候，我花了"),e("a",{href:"https://youtu.be/EyyEfxrk_NU?t=21m4s",target:"_blank",rel:"noopener"},"差不多 20 分钟"),s("讲了这样一点：")],-1),e("blockquote",null,[e("p",null,[e("a",{href:"https://infrequently.org/",target:"_blank",rel:"noopener"},"Alex"),s("，你昨天演讲展示了华盛顿邮报(Washington Post)的 "),e("a",{href:"https://www.ampproject.org/",target:"_blank",rel:"noopener"},"AMP"),s(" （——译者注：Accelerated Mobile Pages Project） demo。轻轻那么一点，华盛顿邮报的 AMP 应用就出来了，还能够通过"),e("a",{href:"https://www.ampproject.org/docs/reference/extended/amp-install-serviceworker.html",target:"_blank",rel:"noopener"},"自定义元素"),s("安装 Service Worker。可是我去看浏览器地址栏的时候……并不是华盛顿邮报。只是 AMP 的 CDN 而已。所以我和 AMP 团队的 "),e("a",{href:"https://paulbakaus.com/",target:"_blank",rel:"noopener"},"Paul Backaus"),s(" 聊了聊，他解释说那是一个 iframe，使用 iframe 能安装其他地方的 Service Worker。")])],-1),e("p",null,[s("Alex 和 "),e("a",{href:"https://twitter.com/emschec",target:"_blank",rel:"noopener"},"Emily"),s(" 解释说，嗯，这就是 iframe 的工作方式。当你仔细想想，其实还是挺有意义的，毕竟一个 iframe 和任何其他的浏览器窗口没什么不一样的。尽管如此，这还是会让人觉得有点违反"),e("a",{href:"https://en.wikipedia.org/wiki/Principle_of_least_astonishment",target:"_blank",rel:"noopener"},"最小惊奇原则"),s("。")],-1),e("p",null,[s("让我们假设，你遵循了我这并不当真的建议，去"),e("a",{href:"https://adactio.com/journal/10800",target:"_blank",rel:"noopener"},"创建一个渐进式的 Web 应用商店"),s("，其首页可能有最新的十到二十个渐进式 Web App。你也可以同样地使用十到二十个 iframe，以便给浏览页面的用户“预安装”( pre-install )这些网站。")],-1),e("p",null,"理论扯够了。现在来点实际操作……",-1),e("p",null,[s("假设你从未访问过我写的书的网站，"),e("a",{href:"https://html5forwebdesigners.com/",target:"_blank",rel:"noopener"},"html5forwebdesigners.com"),s("(如果你访问过，又还想跟着我把实验进行下去，那么你得打开浏览器设置然后删除这个域下面存的所有东西)。")],-1),e("p",null,[s("也许你曾不经意间访问过我的个人网站"),e("a",{href:"https://adactio.com/",target:"_blank",rel:"noopener"},"adactio.com"),s("。主页下面有个小广告，上面写着“Read my book”，链接指向"),e("a",{href:"https://html5forwebdesigners.com/",target:"_blank",rel:"noopener"},"html5forwebdesigners.com"),s("。我在链接后面加了这样两行标记：")],-1),e("pre",null,[e("code",{class:"hljs lang-html"},[e("span",{class:"hljs-tag"},[s("<"),e("span",{class:"hljs-name"},"iframe"),s(),e("span",{class:"hljs-attr"},"src"),s("="),e("span",{class:"hljs-string"},'"https://html5forwebdesigners.com/iframe.html"'),s(),e("span",{class:"hljs-attr"},"style"),s("="),e("span",{class:"hljs-string"},'"width: 0; height: 0; border: 0"'),s(">")]),s(`
`),e("span",{class:"hljs-tag"},[s("</"),e("span",{class:"hljs-name"},"iframe"),s(">")]),s(` 
`)])],-1),e("p",null,[s("该隐藏的 iframe 会拉取"),e("a",{href:"https://html5forwebdesigners.com/iframe.html",target:"_blank",rel:"noopener"},"带有一个 script 元素的空页面"),s("。")],-1),e("pre",null,[e("code",{class:"hljs lang-html"},[e("span",{class:"hljs-meta"},[s("<!DOCTYPE "),e("span",{class:"hljs-keyword"},"html"),s(">")]),s(`
`),e("span",{class:"hljs-tag"},[s("<"),e("span",{class:"hljs-name"},"html"),s(),e("span",{class:"hljs-attr"},"lang"),s("="),e("span",{class:"hljs-string"},'"en"'),s(">")]),s(`
`),e("span",{class:"hljs-tag"},[s("<"),e("span",{class:"hljs-name"},"head"),s(">")]),s(`
`),e("span",{class:"hljs-tag"},[s("<"),e("span",{class:"hljs-name"},"meta"),s(),e("span",{class:"hljs-attr"},"charset"),s("="),e("span",{class:"hljs-string"},'"utf-8"'),s(">")]),s(`
`),e("span",{class:"hljs-tag"},[s("<"),e("span",{class:"hljs-name"},"title"),s(">")]),s("HTML5 For Web Designers"),e("span",{class:"hljs-tag"},[s("</"),e("span",{class:"hljs-name"},"title"),s(">")]),s(`
`),e("span",{class:"hljs-tag"},[s("<"),e("span",{class:"hljs-name"},"script"),s(">")]),e("span",{class:"language-javascript"},[s(`
`),e("span",{class:"hljs-keyword"},"if"),s(" ("),e("span",{class:"hljs-string"},"'serviceWorker'"),s(),e("span",{class:"hljs-keyword"},"in"),s(` navigator) {
  navigator.`),e("span",{class:"hljs-property"},"serviceWorker"),s("."),e("span",{class:"hljs-title function_"},"register"),s("("),e("span",{class:"hljs-string"},"'/serviceworker.js'"),s(`);
}
`)]),e("span",{class:"hljs-tag"},[s("</"),e("span",{class:"hljs-name"},"script"),s(">")]),s(`
`),e("span",{class:"hljs-tag"},[s("</"),e("span",{class:"hljs-name"},"head"),s(">")]),s(`
`),e("span",{class:"hljs-tag"},[s("</"),e("span",{class:"hljs-name"},"html"),s(">")]),s(` 
`)])],-1),e("p",null,[s("这样就注册了我的"),e("a",{href:"https://html5forwebdesigners.com/serviceworker.js",target:"_blank",rel:"noopener"},"书籍网站的 Service Worker"),s("，然后就开始下载所有"),e("a",{href:"https://adactio.com/journal/10754",target:"_blank",rel:"noopener"},"离线渲染整个网站"),s("所需的资源。")],-1),e("p",null,"搞定了。从未访问过 html5forwebdesigners.com 这个域名，但网站已经在你的设备上预加载过了，一切仅仅因为你访问过 adactio.com。",-1),e("p",null,"一些注意事项：",-1),e("p",null,"我不得不降低 html5forwebdesigners.com 的内容安全策略（Content Security Policy），以允许能通过 iframe 将其嵌入 adactio.com:",-1),e("blockquote",null,[e("p",null,[s("Header always set Access-Control-Allow-Origin: “"),e("a",{href:"https://adactio.com",target:"_blank",rel:"noopener"},"https://adactio.com"),s('"')])],-1),e("p",null,"若你的浏览器设置选择了“禁止第三方 cookie 及 网站数据”（“Block third-party cookies and site data”），通过 iframe 调用的 Service Worker 是不会被安装的：",-1),e("blockquote",null,[e("p",null,"Uncaught (in promise) DOMException: Failed to register a ServiceWorker: The user denied permission to use Service Worker.")],-1),e("p",null,"我在本文中的示例相对来说是无害的。不过，可以难想象一些更加极端的情形。想象有一家出版商，有 50 种出版物，每本书有一个网站。每个网站都可能有一个空页面，等待着通过 iframe 被其他 49 个网站嵌入。你只需要访问其中一个页面，就会有 50 个Service Workers 在后台运转起来缓存资源。",-1),e("p",null,[s("这就有了"),e("a",{href:"https://en.wikipedia.org/wiki/Tragedy_of_the_commons",target:"_blank",rel:"noopener"},"“公地悲剧”"),s("的潜在可能。希望我们能清楚的知道，如何去使用这力量。")],-1),e("p",null,"千万别让广告狗们知道哦！（直译：千万别给广告行业知道这。）",-1)])]),_:1})}}};export{g as default};
